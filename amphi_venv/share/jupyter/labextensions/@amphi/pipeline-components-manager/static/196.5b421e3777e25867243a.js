"use strict";(self.webpackChunk_amphi_pipeline_components_manager=self.webpackChunk_amphi_pipeline_components_manager||[]).push([[196],{1196:(e,t,n)=>{n.r(t),n.d(t,{CodeGenerator:()=>z,CodeTextarea:()=>m,CodeTextareaMirror:()=>Pe,ComponentManager:()=>De,GenerateUIFormComponent:()=>ge,InputFile:()=>N,InputRegular:()=>$,PipelineComponent:()=>ke,PipelineService:()=>f,RequestService:()=>O,SelectColumns:()=>Y,SelectRegular:()=>ne,createZoomSelector:()=>xe,default:()=>Ae,onChange:()=>pe,renderComponentUI:()=>we,renderHandle:()=>be,setDefaultConfig:()=>me});var a=n(7262),l=n(473),o=n(6322),r=n(4810),i=n(3345),s=n.n(i);const c=(e,t)=>(console.log("renderFormItem"),s().createElement(r.Form.Item,{style:{marginTop:"5px",padding:"0 0 2px"},label:e.label,className:"nodrag",...e.required?{required:e.required}:{},...e.tooltip?{tooltip:e.tooltip}:{}},t));var d=n(4761),u=n.n(d);n(502),n(3526),n(5159),n(5544);const m=({field:e,value:t,handleChange:n,advanced:a})=>{const[l,o]=(0,i.useState)(t);return(0,i.useRef)(null),(0,i.useEffect)((()=>{o(t)}),[t]),s().createElement(u(),{width:"100%",height:e.height,placeholder:e.placeholder,mode:e.mode,theme:"xcode",name:e.id,onChange:t=>{const a=t;o(a),n(a,e.id)},fontSize:14,lineHeight:19,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,value:l,setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!0,showLineNumbers:!0,tabSize:2}})},p=m;var g=n(4393),v=n(9439);class f{static filterPipeline(e){const t=JSON.parse(e).pipelines[0].flow;return{nodes:t.nodes.map((({id:e,type:t,data:n})=>({id:e,type:t,data:n}))),edges:t.edges.map((({id:e,source:t,target:n,targetHandle:a})=>({id:e,source:t,target:n,targetHandle:a})))}}static extractPackageNames(e){const t=new Set(["json","pandas"]);return e.map((e=>{let n="";return n=e.startsWith("import ")?e.split(" ")[1].split(" as ")[0]:e.startsWith("from ")?e.split(" ")[1]:e,t.has(n)?"":n})).filter(((e,t,n)=>e&&n.indexOf(e)===t))}static findNextNodeIds(e,t){return e.edges.filter((e=>e.source===t)).map((e=>e.target))}static getInstallCommandsFromPackageNames(e){return e.filter((e=>""!==e.trim())).map((e=>e.includes("[")?`!pip install ${e} -q -q`:`\ntry:\n    __import__("${e}")\n    print('${e} is already installed')\nexcept ImportError:\n    !pip install ${e} -q -q`))}static extractPythonImportPackages(e){return(e.match(/^(import .+|from .+? import .+)/gm)||[]).map((e=>e.startsWith("from")?e.split(" ")[1].split(".")[0]:e.split(" ")[1]))}static getPipelineRelativeNodePath(e,t){return v.PathExt.relative(v.PathExt.dirname(e),t)}static getComponentIdForFileExtension(e,t,n){var a,l,o,r;if(!e)return{id:null,default:null};const i=t.getComponents(),s=[];for(const t of i)t._fileDrop&&t._fileDrop.includes(e.toLowerCase())&&s.push(t);if(1===s.length){const e=s[0];return{id:e._id,default:e._default||null}}for(const e of s)if(console.log("Component._default?.backend?.engine: %o",null===(l=null===(a=e._default)||void 0===a?void 0:a.backend)||void 0===l?void 0:l.engine),(null===(r=null===(o=e._default)||void 0===o?void 0:o.backend)||void 0===r?void 0:r.engine)===n)return{id:e._id,default:e._default||null};if(s.length>0){const e=s[0];return{id:e._id,default:e._default||null}}return{id:null,default:null}}static getLastUpdatedInPath(e,t){const n=new Set,a=[],l=t=>{if(n.has(t))return;n.add(t);const o=e.nodes.find((e=>e.id===t));o&&o.data&&o.data.lastUpdated&&a.push(o.data.lastUpdated),e.edges.filter((e=>e.target===t)).map((e=>e.source)).forEach((e=>{l(e)}))};return l(t),a}static getRelativePath(e,t){const n=v.PathExt.dirname(e);return v.PathExt.relative(n,t)}static getEnvironmentVariables(e){return f.filterPipeline(e).nodes.filter((e=>"envVariables"===e.type||"envFile"===e.type)).reduce(((e,t)=>{const n=t.data.variables||[];return e.concat(n.map((e=>e.name)))}),[])}static getConnections(e){return f.filterPipeline(e).nodes.filter((e=>"connection"===e.type)).reduce(((e,t)=>e.concat(t.data||[])),[])}static extractConnections(e){const t=e.getComponents(),n={};return t.forEach((e=>{e._form&&e._form.fields&&e._form.fields.forEach((e=>{e.connection&&!e.ignoreConnection&&(n[e.connection]||(n[e.connection]=[]),n[e.connection].find((t=>t.id===e.id))||n[e.connection].push({id:e.id,label:e.label}))}))})),Object.keys(n).map((e=>({connection:e,fields:n[e]})))}}f.findStartNode=(e,t)=>{const n=new Set;e.edges.forEach((e=>n.add(e.target)));for(const a of e.nodes){const e=t.getComponent(a.type)._type;if(!n.has(a.id)&&("pandas_df_input"===e||"ibis_df_input"===e))return a.id}return null},f.getNodeById=(e,t)=>JSON.parse(e).pipelines[0].flow.nodes.find((e=>e.id===t))||null,f.findStartNodes=(e,t)=>{const n=new Set;e.edges.forEach((e=>n.add(e.target)));const a=[];for(const l of e.nodes){const e=t.getComponent(l.type)._type;if(!n.has(l.id)&&"pandas_df_input"===e&&(a.push(l.id),2===a.length))return a}return 1===a.length?a:[]},f.findPreviousNodeId=(e,t)=>{let n="";return e.edges.forEach((e=>{e.target===t&&(n=e.source)})),n},f.findMultiplePreviousNodeIds=(e,t)=>{const n=new Map;return e.edges.forEach((e=>{if(e.target===t){const t=e.targetHandle||"default";n.has(t)||n.set(t,[]),n.get(t).push(e.source)}})),Array.from(n.entries()).sort(((e,t)=>e[0].localeCompare(t[0]))).map((([e,t])=>t)).reduce(((e,t)=>e.concat(t)),[])},f.findTwoPreviousNodeIds=(e,t)=>{let n=[];if(e.edges.forEach((e=>{e.target===t&&n.push(e.source)})),2!==n.length)throw new Error("Exactly two previous nodes are not found.");return n},f.formatVarName=e=>e.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase().replace(/\s+/g,"_").replace(/\./g,"_");var h=n(700),E=n(1327),y=n(5256);const C="amphi-browseFileDialog-open";class b extends E.BreadCrumbs{constructor(e){super(e),this.model=e.model,this.rootPath=e.rootPath}onUpdateRequest(e){super.onUpdateRequest(e);const t=this.model.manager.services.contents.localPath(this.model.path);t&&this.rootPath&&0===t.indexOf(this.rootPath)&&document.querySelectorAll(".amphi-browseFileDialog .jp-BreadCrumbs > span[title]").forEach((e=>{var t;0===e.title.indexOf(null!==(t=this.rootPath)&&void 0!==t?t:"")?e.className=e.className.replace("amphi-BreadCrumbs-disabled","").trim():-1===e.className.indexOf("amphi-BreadCrumbs-disabled")&&(e.className+=" amphi-BreadCrumbs-disabled")}))}}class S extends y.Widget{constructor(e){super(e),this.model=new E.FilterFileBrowserModel({manager:e.manager,filter:e.filter});const t=this.layout=new y.PanelLayout;this.directoryListing=new E.DirListing({model:this.model}),this.acceptFileOnDblClick=e.acceptFileOnDblClick,this.multiselect=e.multiselect,this.includeDir=e.includeDir,this.dirListingHandleEvent=this.directoryListing.handleEvent,this.directoryListing.handleEvent=e=>{this.handleEvent(e)},this.breadCrumbs=new b({model:this.model,rootPath:e.rootPath}),t.addWidget(this.breadCrumbs),t.addWidget(this.directoryListing)}static async init(e){const t=e.extensions&&e.extensions.length>0?t=>{if("directory"===t.type)return!0;const n=`.${t.name.split(".").pop().toLowerCase()}`;return e.extensions.includes(n)}:e.filter||(()=>!0),n=new S({manager:e.manager,filter:t,multiselect:e.multiselect,includeDir:e.includeDir,rootPath:e.rootPath,startPath:e.startPath,acceptFileOnDblClick:e.acceptFileOnDblClick});return e.startPath?e.rootPath&&0!==e.startPath.indexOf(e.rootPath)||await n.model.cd(e.startPath):e.rootPath&&await n.model.cd(e.rootPath),n}getValue(){const e=[];for(const t of this.directoryListing.selectedItems())(this.includeDir||"directory"!==t.type)&&e.push(t);return e}handleEvent(e){let t=!1;switch((e instanceof MouseEvent||e instanceof KeyboardEvent)&&(t=e.shiftKey||e.metaKey),e.type){case"keydown":case"keyup":case"mousedown":case"mouseup":case"click":!this.multiselect&&t||this.dirListingHandleEvent.call(this.directoryListing,e);break;case"dblclick":{const t=this.directoryListing.modelForClick(e);if("directory"===(null==t?void 0:t.type))this.dirListingHandleEvent.call(this.directoryListing,e);else if(e.preventDefault(),e.stopPropagation(),this.acceptFileOnDblClick){const e=document.querySelector(`.${C} .jp-mod-accept`);e&&e.click()}break}default:this.dirListingHandleEvent.call(this.directoryListing,e)}}}const w=async(e,t)=>{const n=await S.init({manager:e,filter:t.filter,multiselect:t.multiselect,includeDir:t.includeDir,rootPath:t.rootPath,startPath:t.startPath,acceptFileOnDblClick:!Object.prototype.hasOwnProperty.call(t,"acceptFileOnDblClick")||t.acceptFileOnDblClick}),a=new h.Dialog({title:"Select a file",body:n,buttons:[h.Dialog.cancelButton(),h.Dialog.okButton({label:"Select"})]});return a.addClass("amphi-browseFileDialog"),document.body.className+=` ${C}`,a.launch().then((e=>{if(document.body.className=document.body.className.replace(C,"").trim(),t.rootPath&&e.button.accept&&e.value.length){const n=t.rootPath.endsWith("/")?t.rootPath:t.rootPath+"/";e.value.forEach((e=>{e.path=e.path.replace(n,"")}))}return e}))};var x=n(962);const k=()=>s().createElement("svg",{width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"currentColor"},s().createElement("path",{d:"M4 18V14.3C4 13.4716 3.32843 12.8 2.5 12.8H2V11.2H2.5C3.32843 11.2 4 10.5284 4 9.7V6C4 4.34315 5.34315 3 7 3H8V5H7C6.44772 5 6 5.44772 6 6V10.1C6 10.9858 5.42408 11.7372 4.62623 12C5.42408 12.2628 6 13.0142 6 13.9V18C6 18.5523 6.44772 19 7 19H8V21H7C5.34315 21 4 19.6569 4 18ZM20 14.3V18C20 19.6569 18.6569 21 17 21H16V19H17C17.5523 19 18 18.5523 18 18V13.9C18 13.0142 18.5759 12.2628 19.3738 12C18.5759 11.7372 18 10.9858 18 10.1V6C18 5.44772 17.5523 5 17 5H16V3H17C18.6569 3 20 4.34315 20 6V9.7C20 10.5284 20.6716 11.2 21.5 11.2H22V12.8H21.5C20.6716 12.8 20 13.4716 20 14.3Z"})),_=e=>s().createElement(x.A,{component:k,...e}),I=({field:e,value:t,handleChange:n,context:a,advanced:l})=>{const[o,r]=(0,i.useState)(t),c=(0,i.useRef)(null),[d,u]=(0,i.useState)(!1),[m,p]=(0,i.useState)([]),[g,v]=(0,i.useState)(!1);(0,i.useEffect)((()=>{v(!!o)}),[o]),(0,i.useEffect)((()=>{r(t)}),[t]);const h=t=>{r(t),n(t,e.id)},E=o?s().createElement("span",null):s().createElement(_,{style:{color:"grey",transition:"color 0.3s"},onMouseEnter:e=>e.currentTarget.style.color="#43786E",onMouseLeave:e=>e.currentTarget.style.color="grey",onClick:()=>{d||p([{label:s().createElement("span",null,"Environment Variables"),options:f.getEnvironmentVariables(a.model.toString()).map((e=>(e=>({value:e,label:s().createElement("div",{style:{display:"flex",justifyContent:"space-between"}},e)}))(e)))}]),u((e=>!e))}});return{inputValue:o,inputRef:c,openValue:d,setOpenValue:u,optionsVariables:m,handleInputChange:h,handleSelect:(e,t)=>{h(`{os.getenv('${e}')}`)},filterOptions:(e,t)=>{if(!t||void 0===t.value)return!1},suffix:E}},N=({field:e,value:t,handleChange:n,context:a,advanced:l,manager:o})=>{const{inputValue:i,inputRef:c,openValue:d,setOpenValue:u,optionsVariables:m,handleInputChange:p,handleSelect:v,filterOptions:h,suffix:E}=I({field:e,value:t,handleChange:n,context:a,advanced:l});return s().createElement(r.Space.Compact,{style:{width:"100%"}},s().createElement(r.AutoComplete,{ref:c,id:e.id,options:m,filterOption:h,size:l?"middle":"small",open:d,onBlur:()=>u(!1),defaultOpen:!1,value:i,onChange:p,onSelect:v},s().createElement(r.Input,{placeholder:e.placeholder,ref:c,id:e.id,size:l?"middle":"small",name:e.id,autoComplete:"off",suffix:E})),s().createElement(r.Button,{type:"primary",size:l?"middle":"small",onClick:async()=>{const e=await w(o,{multiselect:!1,includeDir:!0,filter:e=>e.path!==a.path});p(f.getRelativePath(a.path,e.value[0].path))}},s().createElement(g.A,null)))},F=s().memo(N);var V=n(3510);const P=s().memo((({field:e,values:t,handleChange:n,context:a,advanced:l,manager:o})=>{const[c,d]=(0,i.useState)((t||[]).map((e=>({label:e,value:e})))),[u,m]=(0,i.useState)(""),p=(0,i.useRef)(null);(0,i.useEffect)((()=>{t&&d(t.map((e=>({label:e,value:e}))))}),[t]);const v=t=>{if(t.preventDefault(),u&&!c.find((e=>e.value===u))){const t={label:u,value:u},a=[...c,t];d(a),n(a.map((e=>e.value)),e.id),m(""),setTimeout((()=>{var e;null===(e=p.current)||void 0===e||e.focus()}),0)}},h=e=>{m(e.target.value)};return s().createElement(r.Space.Compact,{style:{width:"100%"}},s().createElement(r.Select,{mode:"multiple",labelInValue:!0,size:l?"middle":"small",style:{width:"100%"},className:"nodrag",onChange:t=>{d(t),n(t.map((e=>e.value)),e.id)},value:c,placeholder:e.placeholder||"Select files",...e.required?{required:e.required}:{},...e.tooltip?{tooltip:e.tooltip}:{},dropdownRender:e=>s().createElement(s().Fragment,null,e,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{padding:"0 8px 4px"}},s().createElement(r.Input,{placeholder:"Add file",ref:p,value:u,onChange:h,onKeyDown:e=>{"Enter"===e.key&&v(e)}}),s().createElement(r.Button,{type:"text",icon:s().createElement(V.A,null),onClick:v},"Add"))),options:c}),s().createElement(r.Button,{type:"primary",size:l?"middle":"small",onClick:async()=>{try{const t=await w(o,{multiselect:!0,includeDir:!0,filter:e=>e.path!==a.path});if(console.log("res %o",t),t.value&&t.value.length>0){const l=t.value.map((e=>f.getRelativePath(a.path,e.path))).map((e=>({label:e,value:e}))),o=[...c,...l].filter(((e,t,n)=>t===n.findIndex((t=>t.value===e.value))));d(o),n(o.map((e=>e.value)),e.id)}}catch(e){console.error("Error selecting files:",e)}}},s().createElement(g.A,null)))})),D=s().memo((({field:e,value:t,handleChange:n,context:a,advanced:l})=>{const[o,c]=(0,i.useState)(!1);return s().createElement(r.Space,null,s().createElement(r.InputNumber,{...e.min?{min:e.min}:{},...e.max?{max:e.max}:{},id:e.id,name:e.id,value:o?void 0:t,onChange:t=>n(t,e.id),disabled:o,changeOnWheel:!0}),e.noneOption&&s().createElement(r.Checkbox,{checked:o,onChange:t=>{c(t.target.checked),t.target.checked&&n("None",e.id)}},"None"))})),$=({field:e,value:t,handleChange:n,context:a,advanced:l})=>{const{inputValue:o,inputRef:i,openValue:c,setOpenValue:d,optionsVariables:u,handleInputChange:m,handleSelect:p,filterOptions:g,suffix:v}=I({field:e,value:t,handleChange:n,context:a,advanced:l});return s().createElement(r.AutoComplete,{ref:i,id:e.id,options:u,filterOption:g,size:l?"middle":"small",open:c,onBlur:()=>d(!1),defaultOpen:!1,value:o,onChange:m,onSelect:p},"password"===e.inputType?s().createElement(r.Input.Password,{placeholder:e.placeholder,ref:i,id:e.id,size:l?"middle":"small",name:e.id,autoComplete:"off",value:o,suffix:v}):s().createElement(r.Input,{placeholder:e.placeholder,ref:i,id:e.id,size:l?"middle":"small",name:e.id,autoComplete:"off",suffix:v}))},A=s().memo($),{TextArea:R}=r.Input,T=s().memo((({field:e,value:t,handleChange:n,advanced:a,rows:l})=>{const[o,r]=(0,i.useState)(t),c=(0,i.useRef)(null);return(0,i.useEffect)((()=>{r(t)}),[t]),s().createElement(R,{ref:c,id:e.id,size:a?"middle":"small",name:e.id,placeholder:e.placeholder,onChange:t=>{const a=t.target.value,l=t.target.selectionStart;r(a),n(a,e.id),setTimeout((()=>{c.current&&(c.current.selectionStart=l,c.current.selectionEnd=l)}),0)},value:o,autoComplete:"off",rows:l})}));var M,L=n(3518);class z{static generateCode(e,t,n,a){try{const{codeList:t,incrementalCodeList:l,executedNodes:o}=this.generateCodeForNodes(f.filterPipeline(e),n,"none",!0,a);return t.join("\n")}catch(e){throw new Error(`Error in generateCodeForNodes: ${e}`)}}static generateCodeUntil(e,t,n,a,l,o){var r;const i=f.filterPipeline(e);i.nodes.some((e=>!e.data.nameId))&&(o=!0);const{nodesToTraverse:s,nodesMap:c}=this.computeNodesToTraverse(i,a,n);let d=!1,u=0;for(const e of s){if(e===a)continue;const t=c.get(e);if(!t){console.error(`Node with id ${e} not found.`);continue}const n=t.data||{},l=n.lastUpdated||0;if(l>u&&(u=l),l>=(n.lastExecuted||0)){d=!0;break}}o&&(d=!0);try{const{codeList:e,incrementalCodeList:s,executedNodes:u}=this.generateCodeForNodes(i,n,a,d,o);if(d){console.log("Generating code from start due to updates in previous nodes. (fromStart: true)");const e="pipeline-metadata-panel:delete-all";t.execute(e,{}).catch((t=>{console.error(`An error occurred during the execution of ${e}.\n${t}`)}))}else console.log("No updates in previous nodes. Generating code for target node only.");const m=Date.now();u.forEach((e=>{const t=c.get(e);t&&t.data&&(t.data.lastExecuted=m)}));const p=null===(r=c.get(a))||void 0===r?void 0:r.data;return p&&(p.lastExecuted=m),l?s:e}catch(e){throw new Error(`Error in generateCodeForNodes: ${e}`)}}static computeNodesToTraverse(e,t,n){const a=new Map,l=new Map,o=[];e.nodes.forEach((e=>{const t=n.getComponent(e.type)._type;"annotation"!==t&&"logger"!==t&&"env_variables"!==t&&"env_file"!==t&&"connection"!==t&&a.set(e.id,e)}));const r=new Set,i=new Map,s=(t,n)=>{if(r.has(t)){const e=i.get(t)||new Set;return void i.set(t,new Set([...e,...n]))}r.add(t);const a=e.edges.filter((e=>e.target===t)).map((e=>e.source));l.set(t,a);const c=new Set([...n,t]);i.set(t,c),a.forEach((e=>{s(e,c)})),o.push(t)};e.nodes.forEach((e=>{r.has(e.id)||s(e.id,new Set)}));let c=[];if("none"!==t){const e=new Set([t]),n=new Set;for(;e.size>0;){const t=new Set;e.forEach((e=>{n.add(e),(l.get(e)||[]).forEach((e=>{n.has(e)||t.add(e)}))})),e.clear(),t.forEach((t=>e.add(t)))}c=o.filter((e=>n.has(e)))}else c=o;return{nodesToTraverse:c,nodesMap:a,nodeDependencies:l,sortedNodes:o}}static formatVariables(e){return e.split("\n").map((e=>/r(['"]).*\1/.test(e)||/f(['"])/.test(e)||/f("""|''')/.test(e)?e:e.replace(/(['"])\{(\w+)\}\1/g,"$2").replace(/(['"])(.*\{.*\}.*)\1/g,"f$1$2$1").replace(/(f?"""\s*)(.*\{.*\}.*)(\s*""")/g,'f"""$2"""'))).join("\n")}static getEnvironmentVariableCode(e,t){const n=f.filterPipeline(e),a=new Map,l=new Set;n.nodes.forEach((e=>{const n=t.getComponent(e.type)._type;"env_variables"!==n&&"env_file"!==n||a.set(e.id,e)}));let o="";return a.size>0?(a.forEach(((e,n)=>{const a=t.getComponent(e.type);let r=e.data;a.provideImports({config:r}).forEach((e=>l.add(e))),o+=a.generateComponentCode({config:r})})),`${Array.from(l).join("\n")}\n\n${o}`):"# No environment variable components found."}static getConnectionCode(e,t){const n=f.filterPipeline(e),a=new Map,l=new Set;n.nodes.forEach((e=>{"connection"===t.getComponent(e.type)._type&&a.set(e.id,e)}));let o="";return a.size>0?(a.forEach(((e,n)=>{const a=t.getComponent(e.type);let r=e.data;a.provideImports({config:r}).forEach((e=>l.add(e))),o+=a.generateComponentCode({config:r})})),`${Array.from(l).join("\n")}\n\n${o}`):"# No connection components found."}static getComponentAndDataForNode(e,t,n){const a=f.filterPipeline(n).nodes.find((t=>t.id===e));if(!a)return console.error(`Node with id ${e} not found.`),null;const l=t.getComponent(a.type);return l?{component:l,data:a.data}:(console.error(`Component for node type ${a.type} not found.`),null)}}M=z,z.generateCodeForNodes=(e,t,n,a,l)=>{const o=[],r=[],i=new Set,s=new Set,c=new Set,d=new Set,u=new Map,m=new Map,{nodesToTraverse:p,nodesMap:g}=M.computeNodesToTraverse(e,n,t);e.nodes.forEach((e=>{const n=t.getComponent(e.type)._type;"env_variables"===n||"env_file"===n?u.set(e.id,e):"connection"===n&&m.set(e.id,e)}));try{const v=M.createNodeObjects(e,t,p,g,l);for(const e of v){e.imports.forEach((e=>s.add(e))),e.dependencies.forEach((e=>c.add(e))),e.functions.forEach((e=>d.add(e)));const t=[...e.imports,...e.functions,e.code].join("\n");if(r.push({code:t,nodeId:e.id}),o.push(e.code),i.add(e.id),e.id===n){console.log("nodeObject %o",e);let t="";if(e.type.includes("processor")||e.type.includes("input"))e.type.includes("documents")?(a||(console.log("Generate code from last component. (fromStart: false)"),o.length=0,o.push(e.code),i.clear(),i.add(e.id)),t=`\n_amphi_display_documents_as_html(${e.outputName})`):(a||(console.log("Generate code from last component. (fromStart: false)"),o.length=0,o.push(e.code),i.clear(),i.add(e.id)),t=`\n__amphi_display_dataframe(${e.outputName}, dfName="${e.outputName}", nodeId="${n}"${"local"!==e.runtime?`, runtime="${e.runtime}"`:""})`),o.push(t),r.length>0&&(r[r.length-1].code+=t);else if(e.type.includes("output")){const e=o.join("\n").split("\n").map((e=>"    "+e)).join("\n");o.length=0,o.push("try:\n"+e),o.push('    print("Execution has been successful")\n'),o.push("except Exception as e:\n"),o.push('    print(f"Execution failed with error {e}")\n'),o.push("    raise\n")}}}let f="";u.forEach((e=>{const n=t.getComponent(e.type),a=e.data;f+=n.generateComponentCode({config:a}),n.provideImports({config:a}).forEach((e=>s.add(e)))}));let h="";m.forEach((e=>{const n=t.getComponent(e.type),a=e.data;h+=n.generateComponentCode({config:a}),n.provideImports({config:a}).forEach((e=>s.add(e)))}));const E=`# Source code generated by Amphi\n# Date: ${(new Date).toISOString().replace(/T/," ").replace(/\..+/,"")}`;return{codeList:[E,`# Additional dependencies: ${Array.from(c).join(", ")}`,...Array.from(s),f,h,...Array.from(d),...o].filter(Boolean).map((e=>M.formatVariables(e))),incrementalCodeList:r,executedNodes:i}}catch(e){throw new Error(`Error in createNodeObjects: ${e}`)}},z.createNodeObjects=(e,t,n,a,l)=>{var o;const r=[],i=new Map,s=new Map;function c(e,t){const n=s.get(e);if(!n)throw new Error(`Input name is undefined for node ${e} in context: ${t}`);return n}function d(e,t,n){let a="";return a=n?`${e.type}${function(e){const t=i.get(e)||0;return i.set(e,t+1),t+1}(t)}`:`${e.data.nameId}`,a}for(const i of n){const n=a.get(i);if(!n){console.error(`Node with id ${i} not found.`);continue}const u=n.data,m=t.getComponent(n.type),p=m._type,g=m._id,v=m.provideImports({config:u}),h="function"==typeof m.provideDependencies?m.provideDependencies({config:u}):[],E="function"==typeof m.provideFunctions?m.provideFunctions({config:u}):[];let y="",C="",b="";if(u.customTitle){const e=!m.generateComponentCode({config:u}).startsWith("\n");b+=`\n# ${u.customTitle}${e?"\n":""}`}try{switch(p){case"pandas_df_processor":case"pandas_df_to_documents_processor":case"ibis_df_processor":case"documents_processor":y=c(f.findPreviousNodeId(e,i),p),C=d(n,g,l),s.set(i,C),b+=m.generateComponentCode({config:u,inputName:y,outputName:C});break;case"ibis_df_double_processor":case"pandas_df_double_processor":{const[t,a]=f.findMultiplePreviousNodeIds(e,i),o=c(t,p),r=c(a,p);C=d(n,g,l),s.set(i,C),b+=m.generateComponentCode({config:u,inputName1:o,inputName2:r,outputName:C});break}case"ibis_df_multi_processor":case"pandas_df_multi_processor":{const t=f.findMultiplePreviousNodeIds(e,i).map((e=>c(e,p)));C=d(n,g,l),s.set(i,C),b+=m.generateComponentCode({config:u,inputNames:t,outputName:C});break}case"pandas_df_input":case"documents_input":C=d(n,g,l),s.set(i,C),b+=m.generateComponentCode({config:u,outputName:C});break;case"ibis_df_input":{C=d(n,g,l),s.set(i,C);const o=f.findNextNodeIds(e,i);let r;for(const n of o){const l=a.get(n);if(l){if("ibis_df_double_processor"===t.getComponent(l.type)._type){const t=f.findMultiplePreviousNodeIds(e,n);if(t.length>1){const e=t.find((e=>e!==i));if(e&&s.has(e)){r=`${c(e,"ibis_df_double_processor")}_backend`;break}}}}}b+=r?m.generateComponentCode({config:u,outputName:C,uniqueEngineName:r}):m.generateComponentCode({config:u,outputName:C});break}case"ibis_df_output":case"pandas_df_output":case"documents_output":y=c(f.findPreviousNodeId(e,i),p),b+=m.generateComponentCode({config:u,inputName:y});break;default:throw new Error(`Pipeline Configuration Error: ${p} for node ${i}`)}r.push({id:i,title:u.customTitle||n.type,imports:v,dependencies:h,type:p,code:b,outputName:C,functions:E,lastUpdated:u.lastUpdated||0,lastExecuted:u.lastExecuted||0,runtime:(null===(o=u.backend)||void 0===o?void 0:o.engine)||"local"})}catch(e){throw console.error(`Error processing node ${i}:`,e),e}}return r};class O{static retrieveDataframeColumns(e,t,n,a,l,o,r,i,s){o(!0);const c=f.filterPipeline(t.model.toString());let d,u="";try{let e=s?f.findMultiplePreviousNodeIds(c,r)[i]:r;const m=new Map(c.nodes.map((e=>[e.id,e]))).get(e);if(console.log("refNode %o",m),m){const{lastUpdated:n,lastExecuted:a,nameId:r}=m.data||{};if(console.log("nameId %o",r),a>=n){console.log("Skip generation");const n=`print(_amphi_metadatapanel_getcontentof(${r||e}))`;return console.log("codeToFetchContent %o",n),t.sessionContext.session.kernel.requestExecute({code:n}).onIOPub=e=>{if("stream"===e.header.msg_type){const t=e.content.text;console.log("output %o",t);const n=/([^,]+)\s+\(([^,]+),\s*(named|unnamed)\)/g,a=[];let r;for(;null!==(r=n.exec(t));){const[e,t,n,l]=r;a.push({value:t.trim(),label:t.trim(),type:n.trim(),named:"named"===l.trim()})}l((e=>{const t=new Set(e.map((e=>e.value))),n=a.filter((e=>!t.has(e.value)));return[...e,...n]})),o(!1)}else if("error"===e.header.msg_type){o(!1);const t=e;console.error(`Received error: ${t.content.ename}: ${t.content.evalue}`)}},void console.log("return")}}d=z.generateCodeUntil(t.model.toString(),n,a,e,!1,!1),u=d.join("\n")}catch(e){console.error("Error generating code.",e),u=null,o(!1)}const m=u.split("\n");let p=m.pop();const g=p.match(/__amphi_display_dataframe\(([^,]*)/);p=g?g[1]:null,p&&p.trim()&&1===p.trim().split(" ").length?(u=m.join("\n"),t.sessionContext.session.kernel.requestExecute({code:u}).onReply=e=>{"ok"==e.content.status?t.sessionContext.session.kernel.requestExecute({code:`print(_amphi_metadatapanel_getcontentof(${p}))`}).onIOPub=e=>{if("stream"===e.header.msg_type){const t=e.content.text,n=/([^,]+)\s+\(([^,]+),\s*(named|unnamed)\)/g,a=[];let r;for(;null!==(r=n.exec(t));){const[e,t,n,l]=r;a.push({value:t.trim(),label:t.trim(),type:n.trim(),named:"named"===l.trim()})}l((e=>{const t=new Set(e.map((e=>e.value))),n=a.filter((e=>!t.has(e.value)));return[...e,...n]})),o(!1)}else if("error"===e.header.msg_type){o(!1);const t=e;console.error(`Received error: ${t.content.ename}: ${t.content.evalue}`)}}:o(!1)}):o(!1)}static executePythonCode(e,t,n,a){a(!0);const l=t.sessionContext.session.kernel.requestExecute({code:e});l.onIOPub=e=>{if("stream"===e.header.msg_type){const t=e.content.text.split(",").map((e=>e.trim())).map((e=>({value:e,label:e,type:"python",named:!1})));n(t),a(!1)}else if("execute_result"===e.header.msg_type||"display_data"===e.header.msg_type){const t=e.content.data["text/plain"].replace(/['"\[\]]/g,"").split(",").map((e=>e.trim())).map((e=>({value:e,label:e,type:"python",named:!1})));n(t),a(!1)}else if("error"===e.header.msg_type){a(!1);const t=e.content;console.error(`Received error: ${t.ename}: ${t.evalue}`)}},l.onReply=e=>{"ok"!==e.content.status&&a(!1)}}static retrieveTableList(e,t,n,a,l,o,r,i){r(!0);let s=n.replace(/"/g,'\\"');s=s.replace(/{{schema}}/g,t);const c=z.getEnvironmentVariableCode(a.model.toString(),l),d=z.getConnectionCode(a.model.toString(),l),{component:u,data:m}=z.getComponentAndDataForNode(i,l,a.model.toString());if(!u)return console.error("Component or data not found."),void r(!1);const p=u.provideDependencies(m),g=u.provideImports(m);let v=`\n!pip install --quiet ${p.join(" ")} --disable-pip-version-check\n${g.map((e=>`${e}`)).join("\n")}\n${c}\n${d}\n\nquery = """\n${s}\n"""\n${u.generateDatabaseConnectionCode({config:m,connectionName:"engine"})}\n\ntables = pd.read_sql(query, con=engine)\ntables.iloc[:, 0] = tables.iloc[:, 0].str.strip()  # Strip leading/trailing spaces\nformatted_output = ", ".join(tables.iloc[:, 0].tolist())\nprint(formatted_output)\n`;v=z.formatVariables(v);const f=a.sessionContext.session.kernel.requestExecute({code:v});f.onReply=e=>{"ok"==e.content.status||("error"==e.content.status||e.content.status,r(!1))},f.onIOPub=e=>{if("stream"===e.header.msg_type){const t=e;if("stdout"===t.content.name){const e=t.content.text.split(", ").map((e=>{const t=e.trim();return{input:{},value:t,key:t,label:t,type:"table"}}));o((t=>{const n=new Set(t.map((e=>e.key))),a=e.filter((e=>!n.has(e.key)));return[...t,...a]})),r(!1)}}else if("error"===e.header.msg_type){r(!1);const t=e.content;console.error(`Received error: ${t.ename}: ${t.evalue}`)}}}static retrieveTableColumns(e,t,n,a,l,o,r,i,s,c){s(!0);let d=a.replace(/"/g,'\\"');d=d.replace(/{{schema}}/g,t).replace(/{{table}}/g,n);const u=z.getEnvironmentVariableCode(o.model.toString(),r),m=z.getConnectionCode(o.model.toString(),r),{component:p,data:g}=z.getComponentAndDataForNode(c,r,o.model.toString());if(!p)return console.error("Component or data not found."),void s(!1);const v=p.provideDependencies({config:g}),f=p.provideImports({config:g});let h=`\n!pip install --quiet ${v.join(" ")} --disable-pip-version-check\n${f.map((e=>`${e}`)).join("\n")}\n${u}\n${m}\n  \nquery = """\n${d}\n"""\n${p.generateDatabaseConnectionCode({config:g,connectionName:"engine"})}\nschema = pd.read_sql(query, con=engine)\n\n${l}\n`;h=z.formatVariables(h);const E=o.sessionContext.session.kernel.requestExecute({code:h});E.onReply=e=>{"ok"==e.content.status||s(!1)},E.onIOPub=e=>{if("stream"===e.header.msg_type){const t=e;if("stdout"===t.content.name){const e=t.content.text,n=/([^\s,]+)\s+\(((?:[^()]+|\([^)]*\))*)\)/g,a=[];let l;for(;null!==(l=n.exec(e));){const[e,t,n]=l;a.push({input:{},value:t,key:t,type:n.toUpperCase()})}i((e=>{const t=new Set(e.map((e=>e.key))),n=a.filter((e=>!t.has(e.key)));return[...e,...n]})),s(!1)}}else if("error"===e.header.msg_type){s(!1);const t=e.content;console.error(`Received error: ${t.ename}: ${t.evalue}`)}}}static retrieveSheetNames(e,t,n,a,l,o){var r;l(!0);try{const e=z.getEnvironmentVariableCode(t.model.toString(),n);console.log("nodeId %o",o),console.log("componentService %o",n),console.log("context.model.toString() %o",t.model.toString());const{component:i,data:s}=z.getComponentAndDataForNode(o,n,t.model.toString());if(console.log("data %o",s),!i)throw new Error("Component or data not found.");if(!s.filePath)throw new Error("filePath is missing in the node data.");null===(r=s.backend)||void 0===r?void 0:r.prefix,i.generateComponentCode({config:{...s},outputName:"excel_file"});const c=i.provideDependencies({config:s}),d=i.provideImports({config:s}),u={...s.excelOptions};let m=i.generateOptionsCode(u).split(",").filter((e=>e.trim().startsWith("engine"))).join(","),p=`\n!pip install --quiet ${c.join(" ")} --disable-pip-version-check\n${d.map((e=>`${e}`)).join("\n")}\n${e}\n\nexcel_obj = pd.ExcelFile("${s.filePath}"${m?`, ${m}`:""})\nsheet_names = excel_obj.sheet_names\nprint(", ".join(sheet_names))\n`;console.log("code %o",p),p=z.formatVariables(p);const g=t.sessionContext.session.kernel.requestExecute({code:p});g.onReply=e=>{if("ok"!==e.content.status)return l(!1),void console.error("Execution failed:",e.content)},g.onIOPub=e=>{if("stream"===e.header.msg_type){const t=e;if("stdout"===t.content.name){const e=t.content.text;console.log("output %o",e);const n=e.split(", ");console.log("sheets %o",n);const o=n.map((e=>({input:{},value:e.trim(),key:e.trim(),label:e.trim(),type:"sheet"})));a((e=>{const t=new Set(e.map((e=>e.key))),n=o.filter((e=>!t.has(e.key)));return[...e,...n]})),l(!1)}}else if("error"===e.header.msg_type){l(!1);const t=e.content.evalue;console.error(`Error: ${t}`)}},g.onDone=()=>{l(!1)}}catch(e){console.error("Error in retrieveSheetNames:",e),l(!1)}}static retrieveEnvVariables(e,t,n,a){n(!0);let l='\n!pip install --quiet python-dotenv --disable-pip-version-check\nfrom dotenv import dotenv_values\n  \nenv_vars = dotenv_values(".env")\nformatted_output = ", ".join([f"{k} ({v})" for k, v in env_vars.items()])\nprint(formatted_output)\n';l=z.formatVariables(l);const o=e.sessionContext.session.kernel.requestExecute({code:l});o.onReply=e=>{"ok"==e.content.status||("error"==e.content.status||e.content.status,n(!1))},o.onIOPub=e=>{if("stream"===e.header.msg_type){const a=e.content.text,l=/([^\s,]+)\s+\(((?:[^()]+|\([^)]*\))*)\)/g,o=[];let r;for(;null!==(r=l.exec(a));){const[e,t,n]=r;o.push({input:{},value:t,key:t,type:n})}t((e=>{const t=new Set(e.map((e=>e.key))),n=o.filter((e=>!t.has(e.key)));return[...e,...n]})),n(!1)}else if("error"===e.header.msg_type){n(!1);const t=e.content;console.error(`Received error: ${t.ename}: ${t.evalue}`)}}}}const q=({field:e,value:t={},onChange:n})=>{const[a,l]=(0,i.useState)(""),[o,c]=(0,i.useState)(""),[d,u]=(0,i.useState)(""),m=(0,i.useRef)(null),[p,g]=(0,i.useState)(e.typeOptions),v=e=>{null==n||n({name:a,type:o,...t,...e})},f=e=>{u(e.target.value)},h=e=>{e.preventDefault(),g([...p,{value:d,label:d}]),l(""),setTimeout((()=>{var e;null===(e=m.current)||void 0===e||e.focus()}),0)};return s().createElement("span",null,s().createElement(r.Input,{type:"text",value:a,placeholder:"Field name",onChange:e=>{const t=e.target.value||"";l(t),v({name:t})},style:{width:150}}),s().createElement(r.Select,{value:o,style:{width:220,margin:"0 8px"},className:"nodrag",onChange:e=>{c(e),v({type:e})},dropdownRender:e=>s().createElement(s().Fragment,null,e,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{padding:"0 8px 4px"}},s().createElement(r.Input,{placeholder:"Custom",ref:m,value:d,onChange:f,onKeyDown:e=>e.stopPropagation()}),s().createElement(r.Button,{type:"text",icon:s().createElement(V.A,null),onClick:h},"Add type"))),options:p.map((e=>({label:e.value,value:e.value})))}))},B=({data:e,field:t,handleChange:n,defaultValue:a,context:l,componentService:o,commands:c,nodeId:d,advanced:u})=>{const m=s().createContext(null),[p,g]=(0,i.useState)(),[v,f]=(0,i.useState)(),[h,E]=(0,i.useState)([]),[y,C]=(0,i.useState)(a||[]);(0,i.useEffect)((()=>{n(y,t.id)}),[y]);const b=()=>s().createElement("div",{style:{textAlign:"center"}},s().createElement(r.Empty,{image:r.Empty.PRESENTED_IMAGE_SIMPLE})),S=[{title:"Input Columns",dataIndex:"input",width:"50%",editable:!0},{title:"Output Schema",dataIndex:"value",width:"50%",editable:!1,render:(e,t)=>s().createElement(s().Fragment,null,s().createElement(r.Space,null,s().createElement("span",null,t.value),s().createElement(r.Tag,null,t.type)))},{title:"",dataIndex:"operation",render:(e,t)=>y.length>=1?s().createElement(r.Popconfirm,{title:"Sure to delete?",onConfirm:()=>k(t.key)},s().createElement(L.A,null)):null}],[w]=r.Form.useForm(),x=e=>{const t=[...y],n=t.findIndex((t=>e.key===t.key)),a=t[n];t.splice(n,1,{...a,...e}),C(t)},k=e=>{const t=y.filter((t=>t.key!==e));C(t)},_={body:{row:({index:e,...t})=>{const[n]=r.Form.useForm();return s().createElement(r.Form,{form:n,component:!1},s().createElement(m.Provider,{value:n},s().createElement("tr",{...t})))},cell:({title:e,editable:n,children:a,dataIndex:v,record:f,handleSave:y,...C})=>{var S,w;(0,i.useContext)(m);const[x,k]=(0,i.useState)(!0);let _=a;return n&&(_=s().createElement(r.Form.Item,{style:{margin:0},name:v,rules:[{required:!0,message:`${e} is required.`}]},s().createElement(r.ConfigProvider,{renderEmpty:b},s().createElement(r.Select,{showSearch:!0,labelInValue:!0,size:u?"middle":"small",style:{width:"100%"},className:"nodrag",onChange:e=>{((e,t)=>{const n=e.value,a=h.find((e=>e.value===n));t.input=a,y(t)})(e,f)},value:null!==(w=null===(S=f.input)||void 0===S?void 0:S.value)&&void 0!==w?w:"",placeholder:"Select column ...",...t.required?{required:t.required}:{},...t.tooltip?{tooltip:t.tooltip}:{},dropdownRender:e=>s().createElement(s().Fragment,null,e,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"0 2px 2px"}},s().createElement(r.Button,{type:"primary",onClick:e=>{O.retrieveDataframeColumns(e,l,c,o,E,g,d,0,!0)},loading:p},"Retrieve columns"))),options:h.map((e=>({label:e.label,value:e.value,type:e.type,named:e.named}))),optionRender:e=>s().createElement(r.Space,null,s().createElement("span",null," ",e.data.label),s().createElement(r.Tag,null,e.data.type))})))),s().createElement("td",{...C},_)}}},I=S.map((e=>e.editable?{...e,onCell:t=>({record:t,editable:e.editable,dataIndex:e.dataIndex,title:e.title,handleSave:x})}:e));return s().createElement(s().Fragment,null,s().createElement("div",null,"relationalDatabase"===t.outputType?s().createElement(r.Button,{type:"primary",size:"small",style:{marginBottom:16},onClick:n=>{var a;C([]),O.retrieveTableColumns(n,`${null!==(a=e.schema)&&void 0!==a?a:"public"}`,`${e.tableName.value}`,`${t.query}`,`${t.pythonExtraction}`,l,o,C,f,d)},loading:v},"Retrieve schema"):null,s().createElement(r.Table,{components:_,rowClassName:()=>"editable-row",bordered:!0,dataSource:y,columns:I}),s().createElement(r.Form,{style:{marginTop:16},name:"Add field row",layout:"inline",form:w},s().createElement(r.Form.Item,{name:"field"},s().createElement(q,{field:t})),s().createElement(r.Form.Item,null,s().createElement(r.Button,{onClick:()=>{const e=w.getFieldsValue();console.log(e),console.log("Received values from form: ",e);const t={input:{},key:e.field.name,value:e.field.name,type:e.field.type};C([...y,t])}},"Add a field")))))};var j=n(713);const H=s().memo((({field:e,handleChange:t,initialValues:n,context:a,componentService:l,commands:o,nodeId:c,advanced:d})=>{const[u,m]=(0,i.useState)(n||[{key:{value:"",type:"",named:!0},value:""}]),[p,g]=(0,i.useState)(),[v,f]=(0,i.useState)([]),h=(0,i.useRef)(null),[E,y]=(0,i.useState)(""),C=()=>{m([...u,{key:"",value:""}]),t(u,e.id)},b=e=>{const t=u.map((e=>e.key)).filter(((t,n)=>n!==e));return v?v.filter((e=>!t.includes(e.value))):[]},S=e=>{y(e.target.value)},w=()=>s().createElement("div",{style:{textAlign:"center"}},s().createElement(r.Empty,{image:r.Empty.PRESENTED_IMAGE_SIMPLE}),s().createElement(r.Button,{type:"primary",onClick:e=>O.retrieveDataframeColumns(e,a,o,l,f,g,c,0,!0),loading:p},"Retrieve columns")),x=e=>{e.preventDefault(),f([...v,{value:E,label:E}]),y(""),setTimeout((()=>{var e;null===(e=h.current)||void 0===e||e.focus()}),0)};return s().createElement(r.Form.List,{name:"keyValue"},((n,{add:a,remove:l})=>s().createElement(s().Fragment,null,s().createElement(r.Form.Item,null,u.map(((n,a)=>{var l;return s().createElement(r.Space,{style:{display:"flex",width:"100%",marginBottom:8},align:"baseline"},s().createElement(r.ConfigProvider,{renderEmpty:w},s().createElement(r.Select,{labelInValue:!0,size:d?"middle":"small",style:{width:"100%",minWidth:"250px"},className:"nodrag",onChange:n=>{((n,a)=>{const l=n.value,{type:o,named:r}=((e,t)=>{const n=e.find((e=>e.value===t));if(n)return{type:n.type,named:n.named}})(v,l),i=[...u];i[a]={...i[a],key:{value:l,type:o,named:r}},m(i),t(i,e.id)})(n,a)},value:n.key,options:b(a).map((e=>({label:e.label,value:e.value}))),placeholder:e.placeholder||"Select ...",...e.required?{required:e.required}:{},...e.tooltip?{tooltip:e.tooltip}:{},dropdownRender:e=>s().createElement(s().Fragment,null,e,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{padding:"0 8px 4px"}},s().createElement(r.Input,{size:d?"middle":"small",placeholder:"Custom",ref:h,value:E,onChange:S,onKeyDown:e=>e.stopPropagation()}),s().createElement(r.Button,{type:"text",icon:s().createElement(V.A,null),onClick:x},"Add item")))})),s().createElement(r.Input,{size:d?"middle":"small",name:`${e.id}_value_${a}`,placeholder:(null===(l=e.placeholder)||void 0===l?void 0:l.value)||"value",id:`${e.id}_value_${a}`,value:n.value,onChange:n=>((n,a,l)=>{const o=[...u];o[a]={...o[a],[l]:n.target.value},m(o),t(o,e.id)})(n,a,"value"),autoComplete:"off"}),s().createElement(j.A,{onClick:()=>(n=>{const a=[...u];a.splice(n,1),m(a),t(a,e.id)})(a)}))}))),s().createElement(r.Form.Item,null,s().createElement(r.Button,{type:"dashed",onClick:C,block:!0,icon:s().createElement(V.A,null)},"Add ",e.elementName?e.elementName:"item")))))})),U=s().memo((({field:e,handleChange:t,initialValues:n,context:a,componentService:l,commands:o,nodeId:c,advanced:d})=>{const[u,m]=(0,i.useState)(n||[{key:{value:"",type:"",named:!0},value:""}]),[p,g]=(0,i.useState)(),[v,f]=(0,i.useState)([]),[h,E]=(0,i.useState)(e.options),y=(0,i.useRef)(null),[C,b]=(0,i.useState)(""),S=()=>{m([...u,{key:"",value:""}]),t(u,e.id)},w=e=>{const t=u.map((e=>e.key)).filter(((t,n)=>n!==e));return v?v.filter((e=>!t.includes(e.value))):[]},x=e=>{b(e.target.value)},k=()=>s().createElement("div",{style:{textAlign:"center"}},s().createElement(r.Empty,{image:r.Empty.PRESENTED_IMAGE_SIMPLE}),s().createElement(r.Button,{type:"primary",onClick:e=>O.retrieveDataframeColumns(e,a,o,l,f,g,c,0,!0),loading:p},"Retrieve columns")),_=e=>{e.preventDefault(),f([...v,{value:C,label:C}]),b(""),setTimeout((()=>{var e;null===(e=y.current)||void 0===e||e.focus()}),0)};return s().createElement(r.Form.List,{name:"keyValue"},((n,{add:a,remove:l})=>s().createElement(s().Fragment,null,s().createElement(r.Form.Item,null,u.map(((n,a)=>s().createElement(r.Space,{direction:"vertical",style:{display:"flex",width:"100%",marginBottom:8}},s().createElement(r.ConfigProvider,{renderEmpty:k},s().createElement(r.Select,{labelInValue:!0,size:d?"middle":"small",className:"nodrag",onChange:n=>{((n,a)=>{const l=n.value,{type:o,named:r}=((e,t)=>{const n=e.find((e=>e.value===t));if(n)return{type:n.type,named:n.named}})(v,l),i=[...u];i[a]={...i[a],key:{value:l,type:o,named:r}},m(i),t(i,e.id)})(n,a)},value:n.key,options:w(a).map((e=>({label:e.label,value:e.value}))),placeholder:"Select ...",...e.required?{required:e.required}:{},...e.tooltip?{tooltip:e.tooltip}:{},dropdownRender:e=>s().createElement(s().Fragment,null,e,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{padding:"0 8px 4px"}},s().createElement(r.Input,{size:d?"middle":"small",placeholder:"Custom",ref:y,value:C,onChange:x,onKeyDown:e=>e.stopPropagation()}),s().createElement(r.Button,{type:"text",icon:s().createElement(V.A,null),onClick:_},"Add item")))})),s().createElement(r.Select,{labelInValue:!0,size:d?"middle":"small",id:`${e.id}_value_${a}`,className:"nodrag",onChange:n=>((n,a,l)=>{const o=[...u];o[a]={...o[a],[l]:n},m(o),t(o,e.id)})(n,a,"value"),value:n.value,placeholder:"Select ...",...e.required?{required:e.required}:{},...e.tooltip?{tooltip:e.tooltip}:{},options:h.map((e=>({label:e.label,value:e.value})))}),s().createElement(j.A,{onClick:()=>(n=>{const a=[...u];a.splice(n,1),m(a),t(a,e.id)})(a)}))))),s().createElement(r.Form.Item,null,s().createElement(r.Button,{type:"dashed",onClick:S,block:!0,icon:s().createElement(V.A,null)},"Add ",e.elementName?e.elementName:"item")))))})),G=s().memo((({field:e,handleChange:t,initialValues:n,context:a,componentService:l,commands:o,nodeId:c,advanced:d})=>{const[u,m]=(0,i.useState)(n||[{key:{value:"",type:"",named:!0},value:""}]),[p,g]=(0,i.useState)(),[v,f]=(0,i.useState)([]),[h,E]=(0,i.useState)(e.options),y=(0,i.useRef)(null),[C,b]=(0,i.useState)(""),S=()=>{m([...u,{key:"",value:""}]),t(u,e.id)},w=e=>{const t=u.map((e=>e.key)).filter(((t,n)=>n!==e));return v?v.filter((e=>!t.includes(e.value))):[]},x=e=>{b(e.target.value)},k=()=>s().createElement("div",{style:{textAlign:"center"}},s().createElement(r.Empty,{image:r.Empty.PRESENTED_IMAGE_SIMPLE}),s().createElement(r.Button,{type:"primary",onClick:e=>O.retrieveDataframeColumns(e,a,o,l,f,g,c,0,!0),loading:p},"Retrieve columns")),_=e=>{e.preventDefault(),f([...v,{value:C,label:C}]),b(""),setTimeout((()=>{var e;null===(e=y.current)||void 0===e||e.focus()}),0)};return s().createElement(r.Form.List,{name:"keyValue"},((n,{add:a,remove:l})=>s().createElement(s().Fragment,null,s().createElement(r.Form.Item,null,u.map(((n,a)=>s().createElement(r.Space,{direction:"vertical",style:{display:"flex",width:"100%",marginBottom:8}},s().createElement(r.ConfigProvider,{renderEmpty:k},s().createElement(r.Select,{labelInValue:!0,size:d?"middle":"small",className:"nodrag",onChange:n=>{((n,a)=>{const l=n.value,{type:o,named:r}=((e,t)=>{const n=e.find((e=>e.value===t));if(n)return{type:n.type,named:n.named}})(v,l),i=[...u];i[a]={...i[a],key:{value:l,type:o,named:r}},m(i),t(i,e.id)})(n,a)},value:n.key,options:w(a).map((e=>({label:e.label,value:e.value}))),placeholder:"Select ...",...e.required?{required:e.required}:{},...e.tooltip?{tooltip:e.tooltip}:{},dropdownRender:e=>s().createElement(s().Fragment,null,e,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{padding:"0 8px 4px"}},s().createElement(r.Input,{size:d?"middle":"small",placeholder:"Custom",ref:y,value:C,onChange:x,onKeyDown:e=>e.stopPropagation()}),s().createElement(r.Button,{type:"text",icon:s().createElement(V.A,null),onClick:_},"Add item")))})),s().createElement(r.Flex,{vertical:!0,gap:"middle"},s().createElement(r.Radio.Group,{value:n.value,onChange:n=>((n,a,l)=>{const o=[...u];o[a]={...o[a],[l]:n},m(o),t(o,e.id)})(n.target.value,a,"value"),buttonStyle:"solid"},h.map((e=>s().createElement(r.Radio.Button,{value:e.value},e.label))))),s().createElement(j.A,{onClick:()=>(n=>{const a=[...u];a.splice(n,1),m(a),t(a,e.id)})(a)}))))),s().createElement(r.Form.Item,null,s().createElement(r.Button,{type:"dashed",onClick:S,block:!0,icon:s().createElement(V.A,null)},"Add ",e.elementName?e.elementName:"item")))))})),K=s().memo((({field:e,handleChange:t,initialValues:n})=>{const[a,l]=(0,i.useState)(n||[{key:"",value:""}]),o=()=>{l([...a,{key:"",value:""}]),t(a,e.id)},c=(n,o,r)=>{const i=[...a];i[o]={...i[o],[r]:n.target.value},l(i),t(i,e.id)};return s().createElement(r.Form.List,{name:"keyValue"},((n,{add:i,remove:d})=>s().createElement(s().Fragment,null,s().createElement(r.Form.Item,null,a.map(((n,o)=>{var i,d;return s().createElement(r.Space,{style:{display:"flex",marginBottom:8},align:"baseline"},s().createElement(r.Input,{name:`${e.id}_key_${o}`,placeholder:(null===(i=e.placeholder)||void 0===i?void 0:i.key)||"key",id:`${e.id}_key_${o}`,value:n.key,onChange:e=>c(e,o,"key"),autoComplete:"off"}),s().createElement(r.Input,{name:`${e.id}_value_${o}`,placeholder:(null===(d=e.placeholder)||void 0===d?void 0:d.value)||"value",id:`${e.id}_value_${o}`,value:n.value,onChange:e=>c(e,o,"value"),autoComplete:"off"}),s().createElement(j.A,{onClick:()=>(n=>{const o=[...a];o.splice(n,1),l(o),t(o,e.id)})(o)}))}))),s().createElement(r.Form.Item,null,s().createElement(r.Button,{type:"dashed",onClick:o,block:!0,icon:s().createElement(V.A,null)},"Add ",e.elementName?e.elementName:"item")))))}));var W=n(7412);const Z=({items:e,setItems:t,setSelectedOption:n})=>{const[a,l]=(0,i.useState)(""),[o,c]=(0,i.useState)("string"),d=(0,i.useRef)(null);return s().createElement(r.Space,{style:{padding:"0 4px 4px"}},s().createElement(r.Row,{gutter:8},s().createElement(r.Col,{span:12},s().createElement(r.Input,{placeholder:"New column",ref:d,value:a,onChange:e=>{l(e.target.value)},onKeyDown:e=>e.stopPropagation()})),s().createElement(r.Col,{span:10},s().createElement(r.Cascader,{autoFocus:!0,style:{width:"100%"},allowClear:!1,options:[{value:"numeric",label:"Numeric",children:[{value:"int",label:"Integer",children:[{value:"int64",label:"int64",tooltip:"Standard integer type."},{value:"int32",label:"int32",tooltip:"For optimized memory usage."},{value:"int16",label:"int16",tooltip:"For more optimized memory usage."},{value:"int8",label:"int8",tooltip:"For more optimized memory usage."},{value:"uint64",label:"uint64",tooltip:"Unsigned integer (can only hold non-negative values)"},{value:"uint32",label:"uint32",tooltip:"For more optimized memory usage."},{value:"uint16",label:"uint16",tooltip:"For more optimized memory usage."},{value:"uint8",label:"uint8",tooltip:"For more optimized memory usage."}]},{value:"float",label:"Float",children:[{value:"float64",label:"float64",tooltip:"Standard floating-point type."},{value:"float32",label:"float32",tooltip:"For optimized memory usage."},{value:"float16",label:"float16",tooltip:"For more optimized memory usage."}]}]},{value:"text",label:"Text",children:[{value:"string",label:"string",tooltip:"For string data. (recommended)"},{value:"object",label:"object",tooltip:"For generic objects (strings, timestamps, mixed types)."},{value:"category",label:"category",tooltip:"For categorical variables."}]},{value:"datetime",label:"Date & Time",children:[{value:"datetime64[ns]",label:"datetime64[ns]",tooltip:"For datetime values."},{value:"datetime64[ms]",label:"datetime64[ms]",tooltip:"For datetime values in milliseconds."},{value:"datetime64[s]",label:"datetime64[s]",tooltip:"For datetime values in seconds."},{value:"datetime32[ns]",label:"datetime32[ns]",tooltip:"For compact datetime storage in nanoseconds."},{value:"datetime32[ms]",label:"datetime32[ms]",tooltip:"For compact datetime storage in milliseconds."},{value:"timedelta[ns]",label:"timedelta[ns]",tooltip:"For differences between two datetimes."}]},{value:"boolean",label:"Boolean",children:[{value:"bool",label:"bool",tooltip:"For boolean values (True or False)."}]}],defaultValue:["text","string"],placement:"topLeft",displayRender:e=>e[e.length-1],onChange:e=>{c(e)},optionRender:e=>s().createElement(r.Space,null,s().createElement("span",null,e.label),e.tooltip&&s().createElement(r.Tooltip,{title:e.tooltip},s().createElement(W.A,null))),getPopupContainer:e=>{let t=e.parentElement;for(;t&&!t.classList.contains("ant-dropdown");)t=t.parentElement;return t||e.parentNode}})),s().createElement(r.Col,{span:2},s().createElement(r.Button,{type:"text",icon:s().createElement(V.A,null),onClick:n=>{n.preventDefault(),t([...e,{value:a,label:a,type:o,named:!0}]),l(""),setTimeout((()=>{var e;null===(e=d.current)||void 0===e||e.focus()}),0)}},"Add"))))},J=s().memo((({field:e,handleChange:t,defaultValue:n,context:a,componentService:l,commands:o,nodeId:c,advanced:d})=>{console.log("SelectColumn");const u=e=>void 0===e?{}:m.find((t=>t.value===e.value))||{value:e.value,label:e.value};(0,i.useEffect)((()=>{h(u(n))}),[n,e.options]);const[m,p]=(0,i.useState)([]),[g,v]=(0,i.useState)(""),[f,h]=((0,i.useRef)(null),(0,i.useState)(u(n))),[E,y]=(0,i.useState)(),C=e.inputNb?e.inputNb-1:0;return s().createElement(r.ConfigProvider,{renderEmpty:()=>s().createElement("div",{style:{textAlign:"center"}},s().createElement(r.Empty,{image:r.Empty.PRESENTED_IMAGE_SIMPLE}))},s().createElement(r.Select,{showSearch:!0,labelInValue:!0,size:d?"middle":"small",style:{width:"100%"},className:"nodrag",onChange:(n,a)=>(n=>{const a=n.value,l=u(a);h(l);const{type:o,named:r}=((e,t)=>{const n=e.find((e=>e.value===t));if(n)return{type:n.type,named:n.named}})(m,a);t({value:a,type:o,named:r},e.id)})(n),value:f,placeholder:e.placeholder||"Select ...",...e.required?{required:e.required}:{},...e.tooltip?{tooltip:e.tooltip}:{},dropdownRender:e=>s().createElement(s().Fragment,null,e,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"0 2px 4px"}},s().createElement(r.Button,{type:"primary",onClick:e=>O.retrieveDataframeColumns(e,a,o,l,p,y,c,C,!0),loading:E},"Retrieve columns")),d&&s().createElement(s().Fragment,null,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{padding:"0 8px 4px"}},s().createElement(Z,{items:m,setItems:p,setSelectedOption:h})))),options:m.map((e=>({label:e.label,value:e.value,type:e.type,named:e.named}))),optionRender:e=>s().createElement(r.Space,null,s().createElement("span",null," ",e.data.label),s().createElement(r.Tag,null,e.data.type))}))})),Y=({field:e,handleChange:t,defaultValues:n,context:a,componentService:l,commands:o,nodeId:c,advanced:d})=>{console.log("SelectColumns");const[u,m]=(0,i.useState)(e.options||[]),[p,g]=(0,i.useState)(n),[v,f]=(0,i.useState)(""),[h,E]=((0,i.useRef)(null),(0,i.useState)()),y=e.inputNb?e.inputNb-1:0,C=(e,t)=>{const n=e.find((e=>e.value===t));if(n)return{type:n.type,named:n.named}};return(0,i.useEffect)((()=>{g(n)}),[n]),s().createElement(r.ConfigProvider,{renderEmpty:()=>s().createElement("div",{style:{textAlign:"center"}},s().createElement(r.Empty,{image:r.Empty.PRESENTED_IMAGE_SIMPLE}))},s().createElement(r.Select,{showSearch:!0,mode:"multiple",labelInValue:!0,size:d?"middle":"small",style:{width:"100%"},className:"nodrag",onChange:n=>{g(n);const a=n.map((e=>({...C(u,e.value),value:e.value})));t(a,e.id)},value:p,placeholder:e.placeholder||"Select ...",...e.required?{required:e.required}:{},...e.tooltip?{tooltip:e.tooltip}:{},dropdownRender:e=>s().createElement(s().Fragment,null,e,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"0 2px 2px"}},s().createElement(r.Button,{type:"primary",onClick:e=>O.retrieveDataframeColumns(e,a,o,l,m,E,c,y,!0),loading:h},"Retrieve columns")),d&&s().createElement(s().Fragment,null,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{padding:"0 8px 4px"}},s().createElement(Z,{items:u,setItems:m,setSelectedOption:g})))),options:u.map((e=>({label:e.label,value:e.value,type:e.type}))),optionRender:e=>s().createElement(r.Space,null,s().createElement("span",null," ",e.data.label),s().createElement(r.Tag,null,e.data.type))}))},Q=s().memo(Y),X=s().memo((({data:e,field:t,handleChange:n,defaultValue:a,context:l,componentService:o,commands:c,nodeId:d,advanced:u})=>{const m=e=>void 0===e?{}:p.find((t=>t.value===e.value))||{value:e.value,label:e.value};(0,i.useEffect)((()=>{y(m(a))}),[a,t.options]);const[p,g]=(0,i.useState)([]),[v,f]=(0,i.useState)(""),h=(0,i.useRef)(null),[E,y]=(0,i.useState)(m(a)),[C,b]=(0,i.useState)(!1),S=(t.inputNb&&t.inputNb,e=>{e.preventDefault(),g([...p,{value:v,label:v,type:"table",named:!0}]),f(""),setTimeout((()=>{var e;null===(e=h.current)||void 0===e||e.focus()}),0)}),w=e=>{f(e.target.value)};return s().createElement(r.ConfigProvider,{renderEmpty:()=>s().createElement("div",{style:{textAlign:"center"}},s().createElement(r.Empty,{image:r.Empty.PRESENTED_IMAGE_SIMPLE}))},s().createElement(r.Select,{showSearch:!0,labelInValue:!0,size:u?"middle":"small",style:{width:"100%"},className:"nodrag",onChange:(e,a)=>(e=>{const a=e.value,l=m(a);y(l);const{type:o,named:r}=((e,t)=>{const n=e.find((e=>e.value===t));if(n)return{type:n.type,named:n.named}})(p,a)||{type:"",named:!1};n({value:a,type:o,named:r},t.id)})(e),value:E,placeholder:t.placeholder||"Select ...",...t.required?{required:t.required}:{},...t.tooltip?{tooltip:t.tooltip}:{},dropdownRender:n=>s().createElement(s().Fragment,null,n,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"0 2px 4px"}},s().createElement(r.Button,{type:"primary",onClick:n=>{var a;return O.retrieveTableList(n,`${null!==(a=e.schema)&&void 0!==a?a:"public"}`,t.query,l,o,g,b,d)},loading:C},"Retrieve")),u&&s().createElement(s().Fragment,null,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{padding:"0 8px 4px"}},s().createElement(r.Input,{placeholder:"Custom",ref:h,value:v,onChange:w,onKeyDown:e=>e.stopPropagation()}),s().createElement(r.Button,{type:"text",icon:s().createElement(V.A,null),onClick:S},"Add")))),options:p.map((e=>({label:e.label,value:e.value,type:e.type,named:e.named}))),optionRender:e=>s().createElement(r.Space,null,s().createElement("span",null," ",e.data.label),s().createElement(r.Tag,null,e.data.type))}))})),ee=s().memo((({field:e,handleChange:t,defaultValue:n,advanced:a})=>{const l=t=>e.options.find((e=>e.value===t))||{value:t,label:t};(0,i.useEffect)((()=>{g(l(n))}),[n,e.options]);const[o,c]=(0,i.useState)(e.options),[d,u]=(0,i.useState)(""),m=(0,i.useRef)(null),[p,g]=(0,i.useState)(l(n)),v=e=>{e.preventDefault(),c([...o,{value:d,label:d}]),u(""),setTimeout((()=>{var e;null===(e=m.current)||void 0===e||e.focus()}),0)},f=e=>{u(e.target.value)};return s().createElement(r.Select,{labelInValue:!0,size:a?"middle":"small",style:{width:"100%"},className:"nodrag",onChange:n=>{g(n),t(null==n?void 0:n.value,e.id)},value:p||void 0,placeholder:e.placeholder||"Select ...",...e.required?{required:e.required}:{},...e.tooltip?{tooltip:e.tooltip}:{},dropdownRender:e=>s().createElement(s().Fragment,null,e,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{padding:"0 8px 4px"}},s().createElement(r.Input,{placeholder:"Custom",ref:m,value:d,onChange:f,onKeyDown:e=>e.stopPropagation()}),s().createElement(r.Button,{type:"text",icon:s().createElement(V.A,null),onClick:v},"Add item"))),options:o.map((e=>({label:e.label,value:e.value})))})})),te=s().memo((({field:e,handleChange:t,defaultValues:n,advanced:a})=>{(0,i.useEffect)((()=>{p(n)}),[n]);const[l,o]=(0,i.useState)(e.options),[c,d]=(0,i.useState)(""),u=(0,i.useRef)(null),[m,p]=(0,i.useState)(n),g=e=>{e.preventDefault(),o([...l,{value:c,label:c}]),d(""),setTimeout((()=>{var e;null===(e=u.current)||void 0===e||e.focus()}),0)},v=e=>{d(e.target.value)};return s().createElement(r.Select,{mode:"multiple",labelInValue:!0,size:a?"middle":"small",style:{width:"100%"},className:"nodrag",onChange:n=>{p(n),t(n.map((e=>e.value)),e.id)},value:m,placeholder:e.placeholder||"Select ...",...e.required?{required:e.required}:{},...e.tooltip?{tooltip:e.tooltip}:{},dropdownRender:e=>s().createElement(s().Fragment,null,e,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{padding:"0 8px 4px"}},s().createElement(r.Input,{placeholder:"Custom",ref:u,value:c,onChange:v,onKeyDown:e=>e.stopPropagation()}),s().createElement(r.Button,{type:"text",icon:s().createElement(V.A,null),onClick:g},"Add"))),options:l.map((e=>({label:e.label,value:e.value})))})})),ne=({field:e,handleChange:t,defaultValue:n,advanced:a})=>{const l=t=>e.options.find((e=>e.value===t))||{value:t,label:t},[o,c]=(0,i.useState)(e.options),[d,u]=(0,i.useState)(n?l(n):void 0);return(0,i.useEffect)((()=>{u(l(n))}),[n,e.options]),s().createElement(r.Select,{labelInValue:!0,size:a?"middle":"small",style:{width:"100%"},className:"nodrag",onChange:n=>{u(n),t(null==n?void 0:n.value,e.id)},value:d||null,placeholder:e.placeholder||"Select ...",...e.required?{required:e.required}:{},...e.tooltip?{tooltip:e.tooltip}:{},options:o.map((e=>({label:e.label,value:e.value,tooltip:e.tooltip}))),optionRender:e=>s().createElement(r.Space,null,s().createElement("span",null,e.data.label),e.data.tooltip&&s().createElement(r.Tooltip,{title:e.data.tooltip},s().createElement(W.A,null)))})},ae=s().memo(ne),le=s().memo((({field:e,handleChange:t,defaultValue:n,advanced:a})=>{(0,i.useEffect)((()=>{d(n)}),[n]);const[l,o]=(0,i.useState)(e.options),[c,d]=(0,i.useState)(n);return s().createElement(r.ConfigProvider,{renderEmpty:()=>s().createElement("span",{style:{display:"none"}})},s().createElement(r.Select,{mode:"tags",labelInValue:!0,size:a?"middle":"small",style:{width:"100%"},className:"nodrag",onChange:n=>{d(n),t(n.map((e=>e.value)),e.id)},value:c,tokenSeparators:[","],placeholder:e.placeholder||"Select ...",...e.required?{required:e.required}:{},...e.tooltip?{tooltip:e.tooltip}:{},options:l.map((e=>({label:e.label,value:e.value})))}))}));var oe=n(5709),re=n(1029);const ie=({children:e})=>{const t=(0,i.useRef)(null),[n,a]=(0,i.useState)(t.current),l=(0,i.useCallback)((()=>{a(null==t?void 0:t.current)}),[]);(0,i.useEffect)((()=>{l()}),[l]);const o=(0,i.useMemo)((()=>({rootElement:n})),[n]);return s().createElement("div",{ref:t},n&&s().createElement(oe.DndProvider,{backend:re.HTML5Backend,options:o},e))},se=s().memo((({field:e,handleChange:t,defaultValue:n,context:a,componentService:l,commands:o,nodeId:c,advanced:d})=>{const u=({index:e,rowDrop:t,className:n,style:a,...l})=>{const o=s().useRef(),[{isOver:r,dropClassName:i},c]=(0,oe.useDrop)({accept:"DragableBodyRow",collect:t=>{const n=t.getItem();return n&&n.index===e?{}:{isOver:t.isOver(),dropClassName:n&&n.index<e?" drop-over-downward":" drop-over-upward"}},drop:n=>{t(n.index,e)}}),[,d]=(0,oe.useDrag)({type:"DragableBodyRow",item:{type:"DragableBodyRow",index:e},collect:e=>({isDragging:e.isDragging()})});return d(c(o)),s().createElement("tr",{ref:o,className:`${n}${r?i:""} draggable`,style:{cursor:"move",opacity:r?.5:1,...a},...l})},[m,p]=(0,i.useState)([]),[g,v]=(0,i.useState)([]),[f,h]=(0,i.useState)([]),[E,y]=(0,i.useState)();(0,i.useEffect)((()=>{const e=m.map((e=>({...e,key:e.value,title:e.value})));v(e),h((t=>t.filter((t=>e.some((e=>e.key===t))))))}),[m]),(0,i.useEffect)((()=>{n&&n.sourceData&&n.targetKeys?(v(n.sourceData),h(n.targetKeys)):(v([]),h([]))}),[n]);const C=[{dataIndex:"value",title:"Column"},{dataIndex:"type",title:"Type",render:e=>s().createElement(r.Tag,null,e)}];return s().createElement(s().Fragment,null,s().createElement((({leftColumns:n,rightColumns:a,...l})=>s().createElement(r.Transfer,{...l},(({direction:l,filteredItems:o,onItemSelect:i,onItemSelectAll:c,selectedKeys:d,disabled:m})=>{const p="left"===l?n:a,v="right"===l?"target":"source",E={getCheckboxProps:()=>({disabled:m}),onChange(e){c(e,"replace")},selectedRowKeys:d,selections:[r.Table.SELECTION_ALL,r.Table.SELECTION_INVERT,r.Table.SELECTION_NONE]};if("source"===v)return s().createElement(r.Table,{rowSelection:E,columns:p,dataSource:o,size:"small",style:{pointerEvents:m?"none":void 0},onRow:({key:e,disabled:t})=>({onClick:()=>{t||m||i(e,!d.includes(e))}})});{const n=(n,a)=>{if(void 0===n||void 0===a)return void console.error("Invalid drag or hover index");let l=[...f];const o=l.splice(n,1)[0];l.splice(a,0,o),h(l),t({sourceData:g,targetKeys:l},e.id)};return s().createElement(ie,null,s().createElement(r.Table,{rowSelection:E,columns:p,dataSource:o,components:{body:{row:u}},size:"small",style:{pointerEvents:m?"none":void 0},onRow:(e,t)=>({index:t,rowDrop:n,onClick:()=>{e.disabled||i(e.key,!d.includes(e.key))}})}))}}))),{dataSource:g,targetKeys:f,showSearch:!0,onChange:n=>{h(n),t({sourceData:g,targetKeys:n},e.id)},operations:["include","exclude"],filterOption:(e,t)=>-1!==t.key.indexOf(e)||-1!==t.type.indexOf(e),leftColumns:C,rightColumns:C,footer:(e,t)=>{if("left"===(null==t?void 0:t.direction))return s().createElement(r.Button,{type:"primary",size:"small",style:{float:"left",margin:5},onClick:e=>{p([]),O.retrieveDataframeColumns(e,a,o,l,p,y,c,0,!0)},loading:E},"Retrieve columns")}}),s().createElement(r.Space,{style:{marginTop:16}}))})),ce=s().memo((({field:e,handleChange:t,initialValues:n})=>{const[a,l]=(0,i.useState)(n||[""]),o=()=>{l([...a,""]),t(a,e.id)};return s().createElement(r.Form.List,{name:"values"},((n,{add:i,remove:c})=>s().createElement(s().Fragment,null,s().createElement(r.Form.Item,null,a.map(((n,o)=>s().createElement(r.Space,{key:o,style:{display:"flex",marginBottom:8},align:"baseline"},s().createElement(r.Input,{name:`${e.id}_value_${o}`,placeholder:"Value",id:`${e.id}_value_${o}`,value:n,onChange:n=>((n,o)=>{const r=[...a];r[o]=n.target.value,l(r),t(r,e.id)})(n,o),autoComplete:"off"}),s().createElement(j.A,{onClick:()=>(n=>{const o=[...a];o.splice(n,1),l(o),t(o,e.id)})(o)}))))),s().createElement(r.Form.Item,null,s().createElement(r.Button,{type:"dashed",onClick:o,block:!0,icon:s().createElement(V.A,null)},"Add Value")))))})),de=s().memo((({field:e,handleChange:t,defaultValue:n,context:a,componentService:l,commands:c,nodeId:d,advanced:u})=>{const[p]=r.Form.useForm(),[g,v]=(0,i.useState)(n||{});return(0,i.useEffect)((()=>{p.setFieldsValue(g)}),[g]),s().createElement(r.Form.List,{name:"items"},((e,{add:t,remove:n})=>s().createElement("div",{style:{display:"flex",rowGap:16,flexDirection:"column"}},e.map((e=>s().createElement(r.Card,{size:"small",title:`Item ${e.name+1}`,key:e.key,extra:s().createElement(o.A,{onClick:()=>{n(e.name)}})},s().createElement(r.Form.Item,{label:"Name",name:[e.name,"name"]},s().createElement(Y,{field:{type:"columns",id:"columns",label:"Columns",placeholder:"Select columns or add new"},handleChange:null,defaultValues:[],context:a,commands:c,componentService:l,nodeId:d,advanced:!0})),s().createElement(r.Form.Item,{label:"Formula",name:[e.name,"formula"]},s().createElement(m,{field:{type:"codeTextarea",id:"formula",label:"Python Formula",placeholder:"row['column1'] + row['column2']"},handleChange:null,advanced:!0,value:""}))))),s().createElement(r.Button,{type:"dashed",onClick:()=>t(),block:!0},"+ Add Formula"))))})),ue=s().memo((({data:e,field:t,handleChange:n,defaultValue:a,context:l,componentService:o,commands:c,nodeId:d,advanced:u})=>{const[m,p]=(0,i.useState)([]),[g,v]=(0,i.useState)(a),[f,h]=(0,i.useState)(!1),[E,y]=(0,i.useState)(""),C=(0,i.useRef)(null);(0,i.useEffect)((()=>{a&&v(a)}),[a]);const b=e=>{O.retrieveSheetNames(e,l,o,p,h,d)},S=()=>{const e={value:E,label:E};p([...m,e]),v([...g,e]),n([...g.map((e=>e.value)),E],t.id),y(""),setTimeout((()=>{var e;return null===(e=C.current)||void 0===e?void 0:e.focus()}),0)},w=e=>{y(e.target.value)};return s().createElement(r.ConfigProvider,{renderEmpty:()=>s().createElement("div",{style:{textAlign:"center"}},s().createElement(r.Empty,{image:r.Empty.PRESENTED_IMAGE_SIMPLE,description:"No sheets available"}))},s().createElement(r.Select,{mode:"multiple",labelInValue:!0,size:u?"middle":"small",style:{width:"100%"},value:g,onChange:e=>{v(e),n(e.map((e=>e.value)),t.id)},placeholder:t.placeholder||"Select sheets",dropdownRender:e=>s().createElement(s().Fragment,null,e,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{display:"flex",justifyContent:"center",padding:"0 8px 4px"}},s().createElement(r.Button,{type:"primary",onClick:b,loading:f},"Retrieve Sheets")),u&&s().createElement(s().Fragment,null,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{padding:"0 8px 4px"}},s().createElement(r.Input,{placeholder:"Custom Sheet",ref:C,value:E,onChange:w,onKeyDown:e=>e.stopPropagation()}),s().createElement(r.Button,{type:"text",icon:s().createElement(V.A,null),onClick:S},"Add")))),options:m.map((e=>({label:e.label,value:e.value})))}))})),me=({nodeId:e,store:t,setNodes:n,defaultConfig:a})=>{const{nodeInternals:l}=t.getState();n(Array.from(l.values()).map((t=>(t.id===e&&1===Object.keys(t.data).length&&(t.data={...a,lastUpdated:null,lastExecuted:null}),t))))},pe=({evtTargetValue:e,field:t,nodeId:n,store:a,setNodes:l})=>{const o=e,{nodeInternals:r}=a.getState(),i=Date.now();l(Array.from(r.values()).map((e=>{if(e.id===n){let n=t.split(".");if(1===n.length)e.data={...e.data,[t]:o};else{const[t,a]=n;e.data={...e.data,[t]:{...e.data[t],[a]:o}}}e.data="lastExecuted"!==t?{...e.data,lastUpdated:i}:{...e.data}}return e})))},ge=s().memo((({nodeId:e,type:t,name:n,form:a,data:l,context:o,componentService:c,manager:d,commands:u,handleChange:m,modalOpen:p,setModalOpen:g})=>{console.log("GenerateUIFormComponent");const v=(0,i.useCallback)((e=>{e.stopPropagation()}),[]),[f]=r.Form.useForm(),[h,E]=(0,i.useState)(f.getFieldsValue());return(0,i.useEffect)((()=>{E(f.getFieldsValue())}),[f]),s().createElement("div",{onDoubleClick:v},s().createElement(r.Form,{form:f,layout:"vertical",size:"small",onValuesChange:(e,t)=>{E(t)}},s().createElement(ve,{name:n,nodeId:e,form:a,data:l,context:o,componentService:c,manager:d,commands:u,handleChange:m,advanced:!1,formValues:h}),s().createElement(fe,{modalOpen:p,setModalOpen:g,name:n,nodeId:e,form:a,data:l,context:o,componentService:c,manager:d,commands:u,handleChange:m,advanced:!0})))})),ve=s().memo((({name:e,nodeId:t,form:n,data:a,context:d,componentService:u,manager:m,commands:g,handleChange:v,advanced:h,formValues:E})=>{console.log("GenerateUIInputs");const[y,C]=(0,i.useState)([]),[b,S]=(0,i.useState)({}),w=(0,i.useCallback)((()=>{console.log("fetchConnections");const e=f.getConnections(d.model.toString());C(e);const t=e.reduce(((e,t)=>{const n=t.connectionType;return e[n]||(e[n]=[]),e[n].push(k(t.connectionName)),e}),{});S(t)}),[d]),x=(0,i.useCallback)(((e,t)=>{if(console.log("shouldDisplay"),!e.condition)return!0;const n=(e,t)=>Object.keys(e).every((a=>{const l=e[a],o=t[a];return"object"!=typeof l||Array.isArray(l)||void 0===o?Array.isArray(l)?l.includes(o):o===l:n(l,o)}));return n(e.condition,t)}),[a]),k=e=>({value:e,label:s().createElement("div",{style:{display:"flex",justifyContent:"space-between"}},e)}),_=(0,i.useCallback)(((e,t)=>{const n=y.find((t=>t.connectionName===e));n&&(n.variables.forEach((e=>{const{key:t,name:n}=e;v(`{${n}}`,`${t}`)})),v(e,t))}),[y,v]),I=(0,i.useCallback)((e=>{const t=a[e],n=y.find((e=>e.connectionName===t));n&&(n.variables.forEach((e=>{const{key:t}=e;v("",`${t}`)})),v("",e))}),[y,a,v]),N=(0,i.useMemo)((()=>n.fields.reduce(((e,t)=>{const n=t.connection||"default";return e[n]||(e[n]=[]),e[n].push(t),e}),{})),[n.fields]),V=(0,i.useCallback)(((e,n)=>{if(!h&&e.advanced)return null;if(!x(e,a))return null;let i,f=[];const E=e.id.split(".");if(Array.isArray(a[e.id]))f=a[e.id];else if(1===E.length)void 0!==a[e.id]&&(i=a[e.id]);else{const[e,t]=E;a[e]&&void 0!==a[e][t]&&(i=a[e][t])}const y={field:e,handleChange:v,context:d,advanced:h};switch(e.type){case"input":return c(e,s().createElement(A,{...y,value:i}));case"radio":return c(e,s().createElement(r.Flex,{vertical:!0,gap:"middle"},s().createElement(r.Radio.Group,{defaultValue:i,onChange:t=>v(t.target.value,e.id),buttonStyle:"solid"},e.options.map((e=>s().createElement(r.Radio.Button,{value:e.value},e.label))))));case"file":return c(e,s().createElement(F,{...y,value:i,manager:m}));case"files":return c(e,s().createElement(P,{...y,values:f,manager:m}));case"columns":return c(e,s().createElement(Q,{...y,defaultValues:f,componentService:u,commands:g,nodeId:t}));case"column":return c(e,s().createElement(J,{...y,defaultValue:i,componentService:u,commands:g,nodeId:t}));case"table":return c(e,s().createElement(X,{...y,data:a,defaultValue:i,componentService:u,commands:g,nodeId:t}));case"sheets":return c(e,s().createElement(ue,{...y,data:a,defaultValue:i,componentService:u,commands:g,nodeId:t}));case"selectCustomizable":return c(e,s().createElement(ee,{...y,defaultValue:i}));case"selectMultipleCustomizable":return c(e,s().createElement(te,{...y,defaultValues:f}));case"selectTokenization":return c(e,s().createElement(le,{...y,defaultValue:i}));case"select":return c(e,s().createElement(ae,{...y,defaultValue:i}));case"textarea":return c(e,s().createElement(T,{...y,value:i,rows:e.rows}));case"codeTextarea":return c(e,s().createElement(p,{...y,value:i}));case"boolean":return c(e,s().createElement(r.Switch,{onChange:t=>v(t,e.id),checkedChildren:s().createElement(l.A,null),unCheckedChildren:s().createElement(o.A,null),defaultChecked:!0===i}));case"cascader":return c(e,s().createElement(r.Cascader,{value:f,placeholder:e.placeholder,options:e.options,...e.onlyLastValue?{displayRender:e=>e[e.length-1]}:{},onChange:t=>v(t,e.id)}));case"keyvalue":return c(e,s().createElement(K,{...y,initialValues:f}));case"keyvalueColumns":return c(e,s().createElement(H,{...y,initialValues:f,componentService:u,commands:g,nodeId:t}));case"keyvalueColumnsSelect":return c(e,s().createElement(U,{...y,initialValues:f,componentService:u,commands:g,nodeId:t}));case"keyvalueColumnsRadio":return c(e,s().createElement(G,{...y,initialValues:f,componentService:u,commands:g,nodeId:t}));case"valuesList":return c(e,s().createElement(ce,{...y,initialValues:f}));case"inputNumber":return c(e,s().createElement(D,{...y,value:i}));case"transferData":return c(e,s().createElement(se,{...y,defaultValue:i,componentService:u,commands:g,nodeId:t}));case"dataMapping":return c(e,s().createElement(B,{data:a,...y,defaultValue:f,componentService:u,commands:g,nodeId:t}));case"formulaColumns":return c(e,s().createElement(de,{...y,defaultValue:i,componentService:u,commands:g,nodeId:t}));case"info":return s().createElement(r.Typography.Paragraph,{style:{padding:"5px"}},e.text);default:return null}}),[a,v,u,g,m,h]);return s().createElement(s().Fragment,null,Object.entries(N).map((([e,t],n)=>{if("default"===e||!h&&t.some((e=>e.advanced)))return null;const l=t;if(!(e=>e.some((e=>x(e,a))))(l))return null;const i=`${e}-${n}`,c=a[i]||"",d=s().createElement(r.Select,{placeholder:"Select Connection",style:{minWidth:200},onClick:w,options:b[e]||[],value:c||void 0,onChange:e=>_(e,i),dropdownRender:e=>s().createElement(s().Fragment,null,e,s().createElement(r.Divider,{style:{margin:"8px 0"}}),s().createElement(r.Space,{style:{padding:"0 4px 4px"}},s().createElement(r.Button,{type:"text",icon:s().createElement(o.A,null),onClick:()=>I(i)},"Remove Connection")))});return s().createElement(r.Card,{size:"small",title:`${e} Connection`,key:`${e}-${n}`,style:{marginTop:"10px",marginBottom:"10px"},extra:d,type:"inner"},l.map(V))})),N.default&&N.default.map(V))}));function fe({name:e,nodeId:t,form:n,data:a,context:l,componentService:o,manager:c,commands:d,handleChange:u,advanced:m,modalOpen:p,setModalOpen:g}){const v=(null==a?void 0:a.customTitle)||e,[f]=r.Form.useForm(),[h,E]=(0,i.useState)(f.getFieldsValue()),y=n.fields.some((e=>"codeTextarea"===e.type))?"80%":800,C=n.fields.some((e=>"codeTextarea"===e.type))?"80%":"1200px";return s().createElement(s().Fragment,null,s().createElement(r.Modal,{title:v,centered:!0,open:p,onOk:()=>g(!1),onCancel:()=>g(!1),width:y,style:{height:C},footer:(e,{OkBtn:t})=>s().createElement(s().Fragment,null,s().createElement(t,null))},s().createElement("div",{onDoubleClick:e=>{e.stopPropagation()}},s().createElement(r.Form,{form:f,layout:"vertical",onValuesChange:(e,t)=>{E(t)}},s().createElement(ve,{name:e,nodeId:t,form:n,data:a,context:l,componentService:o,manager:c,commands:d,handleChange:u,advanced:!0,formValues:h})))))}var he=n(470);new he.LabIcon({name:"amphi:trash-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><g fill="currentColor"><path d="M6.25 6a.75.75 0 01.75.75v5.5a.75.75 0 01-1.5 0v-5.5A.75.75 0 016.25 6zM10.5 6.75a.75.75 0 00-1.5 0v5.5a.75.75 0 001.5 0v-5.5z"/><path fill-rule="evenodd" d="M4 3v-.75A2.25 2.25 0 016.25 0h3.5A2.25 2.25 0 0112 2.25V3h2.25a.75.75 0 010 1.5H14v9.25A2.25 2.25 0 0111.75 16h-7.5A2.25 2.25 0 012 13.75V4.5h-.25a.75.75 0 010-1.5H4zm1.5-.75a.75.75 0 01.75-.75h3.5a.75.75 0 01.75.75V3h-5v-.75zm-2 2.25v9.25c0 .414.336.75.75.75h7.5a.75.75 0 00.75-.75V4.5h-9z" clip-rule="evenodd"/></g></svg>'});const Ee=new he.LabIcon({name:"amphi:cog-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.78 4.28a.75.75 0 00-1.06-1.06L8 6.94 4.28 3.22a.75.75 0 00-1.06 1.06L6.94 8l-3.72 3.72a.75.75 0 101.06 1.06L8 9.06l3.72 3.72a.75.75 0 101.06-1.06L9.06 8l3.72-3.72z"/></svg>'});new he.LabIcon({name:"amphi:settings-icon",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   width="16"\n   height="16"\n   fill="none"\n   viewBox="0 0 16 16"\n   version="1.1"\n   id="svg2"\n   sodipodi:docname="settings-16.svg"\n   inkscape:version="1.3 (0e150ed, 2023-07-21)"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:svg="http://www.w3.org/2000/svg">\n  <defs\n     id="defs2" />\n  <sodipodi:namedview\n     id="namedview2"\n     pagecolor="#505050"\n     bordercolor="#eeeeee"\n     borderopacity="1"\n     inkscape:showpageshadow="0"\n     inkscape:pageopacity="0"\n     inkscape:pagecheckerboard="0"\n     inkscape:deskcolor="#505050"\n     inkscape:zoom="34.875"\n     inkscape:cx="8"\n     inkscape:cy="7.9856631"\n     inkscape:window-width="1392"\n     inkscape:window-height="922"\n     inkscape:window-x="0"\n     inkscape:window-y="75"\n     inkscape:window-maximized="0"\n     inkscape:current-layer="svg2" />\n  <g\n     fill="currentColor"\n     fill-rule="evenodd"\n     clip-rule="evenodd"\n     id="g2">\n    <path\n       d="M8 5a3 3 0 100 6 3 3 0 000-6zM6.5 8a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z"\n       id="path1" />\n    <path\n       d="M7.5 0a1.75 1.75 0 00-1.75 1.75v.15c-.16.06-.318.125-.472.196l-.106-.106a1.75 1.75 0 00-2.475 0l-.707.707a1.75 1.75 0 000 2.475l.106.106a6.46 6.46 0 00-.196.472h-.15A1.75 1.75 0 000 7.5v1c0 .966.784 1.75 1.75 1.75h.15c.06.16.125.318.196.472l-.106.107a1.75 1.75 0 000 2.474l.707.708a1.75 1.75 0 002.475 0l.106-.107c.154.071.312.137.472.196v.15c0 .966.784 1.75 1.75 1.75h1a1.75 1.75 0 001.75-1.75v-.15c.16-.06.318-.125.472-.196l.106.107a1.75 1.75 0 002.475 0l.707-.707a1.75 1.75 0 000-2.475l-.106-.107c.071-.154.137-.311.196-.472h.15A1.75 1.75 0 0016 8.5v-1a1.75 1.75 0 00-1.75-1.75h-.15a6.455 6.455 0 00-.196-.472l.106-.106a1.75 1.75 0 000-2.475l-.707-.707a1.75 1.75 0 00-2.475 0l-.106.106a6.46 6.46 0 00-.472-.196v-.15A1.75 1.75 0 008.5 0h-1zm-.25 1.75a.25.25 0 01.25-.25h1a.25.25 0 01.25.25v.698c0 .339.227.636.555.724.42.113.817.28 1.186.492a.75.75 0 00.905-.12l.493-.494a.25.25 0 01.354 0l.707.708a.25.25 0 010 .353l-.494.494a.75.75 0 00-.12.904c.213.369.38.767.492 1.186a.75.75 0 00.724.555h.698a.25.25 0 01.25.25v1a.25.25 0 01-.25.25h-.698a.75.75 0 00-.724.555c-.113.42-.28.817-.492 1.186a.75.75 0 00.12.905l.494.493a.25.25 0 010 .354l-.707.707a.25.25 0 01-.354 0l-.494-.494a.75.75 0 00-.904-.12 4.966 4.966 0 01-1.186.492.75.75 0 00-.555.724v.698a.25.25 0 01-.25.25h-1a.25.25 0 01-.25-.25v-.698a.75.75 0 00-.555-.724 4.966 4.966 0 01-1.186-.491.75.75 0 00-.904.12l-.494.493a.25.25 0 01-.354 0l-.707-.707a.25.25 0 010-.354l.494-.493a.75.75 0 00.12-.905 4.966 4.966 0 01-.492-1.186.75.75 0 00-.724-.555H1.75a.25.25 0 01-.25-.25v-1a.25.25 0 01.25-.25h.698a.75.75 0 00.724-.555c.113-.42.28-.817.491-1.186a.75.75 0 00-.12-.904L3.05 4.11a.25.25 0 010-.353l.707-.708a.25.25 0 01.354 0l.493.494c.24.24.611.289.905.12a4.965 4.965 0 011.186-.492.75.75 0 00.555-.724V1.75z"\n       id="path2" />\n  </g>\n</svg>\n'}),new he.LabIcon({name:"amphi:search-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M7.25 2a5.25 5.25 0 103.144 9.455l2.326 2.325a.75.75 0 101.06-1.06l-2.325-2.326A5.25 5.25 0 007.25 2zM3.5 7.25a3.75 3.75 0 117.5 0 3.75 3.75 0 01-7.5 0z" clip-rule="evenodd"/></svg>'}),new he.LabIcon({name:"amphi:minus-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M3.5 7.75A.75.75 0 014.25 7h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75z" clip-rule="evenodd"/></svg>'}),new he.LabIcon({name:"amphi:plus-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M9 3.5a.75.75 0 00-1.5 0V7H4a.75.75 0 000 1.5h3.5V12A.75.75 0 009 12V8.5h3.5a.75.75 0 000-1.5H9V3.5z"/></svg>'}),new he.LabIcon({name:"amphi:play-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M3 3.814C3 2.436 4.52 1.6 5.684 2.334l6.628 4.186a1.75 1.75 0 010 2.96l-6.628 4.185C4.52 14.401 3 13.564 3 12.185v-8.37zm1.883-.211a.25.25 0 00-.383.211v8.372a.25.25 0 00.383.211l6.628-4.186a.25.25 0 000-.422L4.884 3.603z" clip-rule="evenodd"/></svg>'}),new he.LabIcon({name:"amphi:play-circle-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><g fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"><path d="M7.421 4.356A1.25 1.25 0 005.5 5.411v5.178a1.25 1.25 0 001.921 1.055l4.069-2.59a1.25 1.25 0 000-2.109L7.42 4.356zM10.353 8L7 10.134V5.866L10.353 8z"/><path d="M8 0a8 8 0 100 16A8 8 0 008 0zM1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0z"/></g></svg>'}),new he.LabIcon({name:"amphi:crosshair-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M0 8a8 8 0 1116 0A8 8 0 010 8zm8.75 6.457V12.75a.75.75 0 00-1.5 0v1.707A6.503 6.503 0 011.543 8.75H3.25a.75.75 0 000-1.5H1.543A6.503 6.503 0 017.25 1.543V3.25a.75.75 0 001.5 0V1.543a6.503 6.503 0 015.707 5.707H12.75a.75.75 0 000 1.5h1.707a6.503 6.503 0 01-5.707 5.707z" clip-rule="evenodd"/></svg>'}),new he.LabIcon({name:"amphi:warning-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M8 1a2.143 2.143 0 00-1.827 1.024l-5.88 9.768a2.125 2.125 0 00.762 2.915c.322.188.687.289 1.06.293h11.77a2.143 2.143 0 001.834-1.074 2.126 2.126 0 00-.006-2.124L9.829 2.028A2.149 2.149 0 008 1zM7 11a1 1 0 011-1h.007a1 1 0 110 2H8a1 1 0 01-1-1zm1.75-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z" clip-rule="evenodd"/></svg>'}),new he.LabIcon({name:"amphi:braces-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M4 18V14.3C4 13.4716 3.32843 12.8 2.5 12.8H2V11.2H2.5C3.32843 11.2 4 10.5284 4 9.7V6C4 4.34315 5.34315 3 7 3H8V5H7C6.44772 5 6 5.44772 6 6V10.1C6 10.9858 5.42408 11.7372 4.62623 12C5.42408 12.2628 6 13.0142 6 13.9V18C6 18.5523 6.44772 19 7 19H8V21H7C5.34315 21 4 19.6569 4 18ZM20 14.3V18C20 19.6569 18.6569 21 17 21H16V19H17C17.5523 19 18 18.5523 18 18V13.9C18 13.0142 18.5759 12.2628 19.3738 12C18.5759 11.7372 18 10.9858 18 10.1V6C18 5.44772 17.5523 5 17 5H16V3H17C18.6569 3 20 4.34315 20 6V9.7C20 10.5284 20.6716 11.2 21.5 11.2H22V12.8H21.5C20.6716 12.8 20 13.4716 20 14.3Z"></path></svg>'});var ye=n(8679),Ce=n(3785);const be=({type:e,Handle:t,Position:n,internals:a})=>{const l=e=>{const{nodeInternals:n,edges:l,nodeId:o,componentService:r}=a,c=(0,i.useMemo)((()=>{if("function"==typeof e.isConnectable){const t=n.get(o),a=(0,Ce.getConnectedEdges)([t],l).filter((t=>t.target===o&&e.id===t.targetHandle));return e.isConnectable({node:t,connectedEdges:a})}if("number"==typeof e.isConnectable){const t=n.get(o);return(0,Ce.getConnectedEdges)([t],l).filter((t=>t.target===o&&e.id===t.targetHandle)).length<e.isConnectable}return e.isConnectable}),[n,l,o,e.isConnectable,e.id]);return s().createElement(t,{...e,isConnectable:c})};switch(e){case"ibis_df_input":case"pandas_df_input":case"documents_input":return s().createElement(t,{className:"handle-right",type:"source",position:n.Right,id:"out"});case"ibis_df_output":case"pandas_df_output":case"documents_output":return s().createElement(l,{type:"target",position:n.Left,isConnectable:1,className:"handle-left",id:"in"});case"ibis_df_processor":case"pandas_df_processor":case"pandas_df_to_documents_processor":case"documents_processor":return s().createElement(s().Fragment,null,s().createElement(l,{type:"target",position:n.Left,isConnectable:1,className:"handle-left",id:"in"}),s().createElement(t,{className:"handle-right",type:"source",position:n.Right,id:"out"}));case"ibis_df_multi_processor":case"pandas_df_multi_processor":return s().createElement(s().Fragment,null,s().createElement(l,{type:"target",position:n.Left,isConnectable:!0,className:"handle-left",id:"in"}),s().createElement(t,{className:"handle-right",type:"source",position:n.Right,id:"out"}));case"ibis_df_double_processor":case"pandas_df_double_processor":return s().createElement(s().Fragment,null,s().createElement(l,{type:"target",position:n.Left,isConnectable:1,className:"handle-left",id:"in1"}),s().createElement(l,{type:"target",position:n.Left,isConnectable:1,className:"second-handle-left",id:"in2"}),s().createElement(t,{className:"handle-right",type:"source",position:n.Right,id:"out"}));default:return null}},Se=s().memo((({id:e,data:t,context:n,manager:a,commands:l,name:o,ConfigForm:c,configFormProps:d,Icon:u,showContent:m,handle:p,deleteNode:g,setViewport:v,handleChange:f,isSelected:h})=>{var E;const[y,C]=(0,i.useState)(t);(0,i.useEffect)((()=>{C(t)}),[t]);const b=(0,i.useMemo)((()=>{var e,n;const a=(null===(n=null===(e=t.backend)||void 0===e?void 0:e.engine)||void 0===n?void 0:n.toLowerCase())||"";return a.includes("snowflake")?"--snowflake":a.includes("duckdb")?"--duckdb":a.includes("postgres")?"--postgres":"--default"}),[null===(E=t.backend)||void 0===E?void 0:E.engine]),S=(0,i.useMemo)((()=>{switch(b){case"--snowflake":return"#00ADEF";case"--duckdb":return"#45421D";case"--postgres":return"#336691";default:return"#5F9B97"}}),[b]),w=(0,i.useMemo)((()=>["--snowflake","--duckdb","--postgres"].includes(b)),[b]),x=(0,i.useCallback)((()=>{v({zoom:1.1,duration:500})}),[v]),k=(0,i.useCallback)((e=>{e.stopPropagation()}),[]),_=(0,i.useCallback)((e=>{e.preventDefault()}),[]),[I,N]=(0,i.useState)((null==t?void 0:t.customTitle)||o),F=(0,i.useCallback)((e=>{N(e),f(e,"customTitle")}),[f]),V={...d,data:y,onValueChange:(e,t)=>{C((n=>{const a={...n,[t]:e};return f(e,t),a}))}},P=(0,i.useMemo)((()=>({token:{colorPrimary:S}})),[S]),D=(0,i.useMemo)((()=>`component component${b} ${w?"ibis":""}`),[b,w]),{Text:$}=r.Typography;return s().createElement(r.ConfigProvider,{theme:P},s().createElement("div",{className:D,onDoubleClick:x},s().createElement("div",{className:"component__header"},s().createElement($,{onDoubleClick:k,onDragStart:_,editable:h?{onChange:F,tooltip:!1,icon:s().createElement(ye.A,{style:{color:"#5F9B97"}})}:void 0,className:"ant-select-sm"},I),s().createElement(r.Popconfirm,{title:"Sure to delete?",placement:"right",onConfirm:g,icon:s().createElement(W.A,{style:{color:"red"}})},s().createElement("div",{className:"deletebutton"},s().createElement(Ee.react,{className:"group-hover:text-primary"})))),s().createElement("div",{className:"component__body"},s().createElement("form",null,s().createElement("div",{style:{display:m?"block":"none"}},s().createElement(c,{...V})),!m&&s().createElement("div",{className:"placeholder"},s().createElement(u.react,{height:"42px",width:"42px",color:S,verticalAlign:"middle"})))),p))}),((e,t)=>e.id===t.id&&e.showContent===t.showContent&&e.isSelected===t.isSelected&&JSON.stringify(e.data)===JSON.stringify(t.data)&&e.name===t.name&&e.configFormProps.modalOpen===t.configFormProps.modalOpen)),we=e=>s().createElement(Se,{...e}),xe=()=>e=>e.transform[2]>=.75;function ke(){return class{constructor(){}static getInstance(){return this.instance||(this.instance=new this),this.instance}static get Name(){return this.getInstance()._name}static get Type(){return this.getInstance()._type}static get Icon(){return this.getInstance()._icon}static get Default(){return this.getInstance()._default}static get Form(){return this.getInstance()._form}static updateType(e){this.getInstance()._type=e}}}var _e=n(45),Ie=n(9007),Ne=n(8e3),Fe=n(1993),Ve=n(5024);const Pe=({field:e,value:t,handleChange:n,advanced:a})=>{const l=(0,i.useRef)(null),o=(0,i.useRef)(null),r=(0,i.useRef)(null);return(0,i.useEffect)((()=>{if(l.current&&!o.current){const a=new Ne.YFile;r.current=a;const i=new _e.CodeEditor.Model({sharedModel:a,mimeType:"text/x-python"}),s=e=>{var t;const n={...e,extensions:[...null!==(t=e.extensions)&&void 0!==t?t:[],(0,Ie.ybinding)({ytext:a.ysource}),(0,Fe.python)(),(0,Ve.lineNumbers)()]};return new Ie.CodeMirrorEditor(n)};o.current=new _e.CodeEditorWrapper({factory:s,model:i,editorOptions:{config:{readOnly:!0}}}),o.current.addClass("jp-InputArea-editor"),l.current.appendChild(o.current.node),a.ysource&&t&&a.ysource.insert(0,t),a.ysource&&t&&a.ysource.insert(0,t),a.ysource.observe((()=>{const l=a.ysource.toString();l!==t&&n(l,e.id)}))}}),[e.id,t,n]),(0,i.useEffect)((()=>{if(r.current&&r.current.ysource){const e=r.current.ysource.toString();t&&t!==e&&(r.current.ysource.delete(0,e.length),r.current.ysource.insert(0,t))}else console.error("ysource is not initialized correctly during update.")}),[t]),s().createElement("div",{ref:l,style:{height:"100%",width:"100%"}})},De=new a.Token("@amphi/pipeline-components-manager:provider");class $e{constructor(){this._components=[],this._components=[]}getComponents(){return this._components}getComponent(e){return this._components.find((t=>t._id===e))}addComponent(e){this._components.push(e)}getComponentCount(){return this._components.length}removeComponent(e){this._components=this._components.filter((t=>t._id!==e))}}const Ae={id:"@amphi/pipeline-components-manager:plugin",description:'Provider plugin for the pipeline editor\'s "component" service object.',autoStart:!0,provides:De,activate:()=>(console.log("JupyterLab extension (@amphi/pipeline-components-manager/provider plugin) is activated!"),new $e)}}}]);